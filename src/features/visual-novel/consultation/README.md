# –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –≥–æ–ª–æ—Å–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–æ–∫—É –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –≥–æ–ª–æ—Å–∞–º–∏ (–Ω–∞–≤—ã–∫–∞–º–∏) –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π –≤ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª–µ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–µ—Ö–∞–Ω–∏–∫–µ –∏–∑ Disco Elysium.

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/features/visual-novel/consultation/
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ VoiceCard.tsx           # –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–¥–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ VoiceCardGroup.tsx      # –°–µ—Ç–∫–∞ –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤
‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îî‚îÄ‚îÄ useConsultationMode.ts  # –•—É–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ voiceDefinitions.ts     # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ 12 –Ω–∞–≤—ã–∫–æ–≤-–≥–æ–ª–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ consultationUtils.ts    # –£—Ç–∏–ª–∏—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ index.ts                    # –≠–∫—Å–ø–æ—Ä—Ç—ã
```

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ VisualNovelLine
interface VisualNovelLine {
  // ... existing fields
  characterAdvices?: VisualNovelAdvice[]
}

// –°–æ–≤–µ—Ç –æ—Ç –≥–æ–ª–æ—Å–∞
interface VisualNovelAdvice {
  characterId: string           // 'logic', 'perception', etc.
  text: string                  // –¢–µ–∫—Å—Ç —Å–æ–≤–µ—Ç–∞
  mood?: VisualNovelMood
  stageDirection?: string
  minSkillLevel?: number        // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞
  maxSkillLevel?: number        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–¥–ª—è "–≥–ª—É–ø—ã—Ö" —Å–æ–≤–µ—Ç–æ–≤)
  requiredFlags?: string[]      // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏
  excludedFlags?: string[]      // –ò—Å–∫–ª—é—á–∞—é—â–∏–µ —Ñ–ª–∞–≥–∏
}
```

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–µ—Ç–æ–≤ –≤ —Å—Ü–µ–Ω—É

```typescript
const line: VisualNovelLine = {
  id: 'scene__choice',
  text: '–ß—Ç–æ –¥–µ–ª–∞—Ç—å?',
  choices: [
    { id: 'option_1', label: '–í–∞—Ä–∏–∞–Ω—Ç 1', ... },
    { id: 'option_2', label: '–í–∞—Ä–∏–∞–Ω—Ç 2', ... },
  ],
  characterAdvices: [
    {
      characterId: 'logic',
      text: '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–∏—Ç—É–∞—Ü–∏—é: –≤–∞—Ä–∏–∞–Ω—Ç 1 –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ...',
      mood: 'serious',
      minSkillLevel: 30,
    },
    {
      characterId: 'perception',
      text: '–ó–∞–º–µ—á–∞—é –¥–µ—Ç–∞–ª–∏: –∑–∞–ø–∞—Ö, –∑–≤—É–∫–∏...',
      mood: 'tense',
      minSkillLevel: 35,
    },
    // ... –¥—Ä—É–≥–∏–µ –≥–æ–ª–æ—Å–∞
  ],
}
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ü–µ–Ω–µ:
```
/vn/test_consultation_scene
```

–ò–ª–∏ –≤ –∫–æ–¥–µ:
```typescript
jumpToScene('test_consultation_scene')
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤

–°–æ–≤–µ—Ç—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ:
- **–£—Ä–æ–≤–Ω—é –Ω–∞–≤—ã–∫–∞**: `skills[characterId] >= minSkillLevel`
- **–§–ª–∞–≥–∞–º**: –ø—Ä–æ–≤–µ—Ä–∫–∞ `requiredFlags` –∏ `excludedFlags`

```typescript
const availableAdvices = filterAvailableAdvices(
  line.characterAdvices,
  skills,
  flags
)
```

### –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å—Ü–µ–Ω—ã
2. **–†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞**: –ü–æ—è–≤–ª—è—é—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ –≥–æ–ª–æ—Å–æ–≤ + –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞
3. **–†–µ–∂–∏–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–≤–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

- **–ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≥–æ–ª–æ—Å–∞** ‚Üí –≤—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- **–ö–ª–∏–∫ –Ω–∞ DialogueBox** (–≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏) ‚Üí –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞
- **–ö–ª–∏–∫ –≤–Ω–µ** ‚Üí –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Å–º–æ—Ç—Ä–∞**: —á–µ–∫–º–∞—Ä–∫ –Ω–∞ —É–∂–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–∞—Ö

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

–í—Å–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å–æ–≤–µ—Ç–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ API:

```typescript
client.vn.logAdvice.post({
  sceneId,
  lineId,
  characterId,        // 'logic', 'perception', etc.
  choiceContext,      // ID –¥–æ—Å—Ç—É–ø–Ω—ã—Ö choices
  skillLevel,         // –£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  viewOrder,          // 1-–π, 2-–π, 3-–π –ø—Ä–æ—Å–º–æ—Ç—Ä?
})
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤
- –°—Ä–µ–¥–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- –°–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤ —á–∏—Ç–∞—é—Ç –ø–µ—Ä–µ–¥ –≤—ã–±–æ—Ä–æ–º
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —É—Ä–æ–≤–Ω—è –Ω–∞–≤—ã–∫–∞

## üé® UI/UX

### VoiceCard

- **–°–æ—Å—Ç–æ—è–Ω–∏—è**: –¥–æ—Å—Ç—É–ø–µ–Ω/–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω
- **–ê–Ω–∏–º–∞—Ü–∏–∏**: –ø—É–ª—å—Å–∞—Ü–∏—è, hover-—ç—Ñ—Ñ–µ–∫—Ç—ã, scale
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**: —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞, –ø–æ–ª–æ—Å–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, —á–µ–∫–º–∞—Ä–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### VoiceCardGroup

- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: —Å–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ, –ø–æ—Ç–æ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (cogito, spirit, psyche, corpus)
- **–ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è**: staggered children
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: 3-4-6 –∫–æ–ª–æ–Ω–æ–∫ (mobile-tablet-desktop)

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–æ–ª–æ—Å–∞

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `voiceDefinitions.ts`:
```typescript
export const VOICE_DEFINITIONS: Record<VoiceId, VoiceDefinition> = {
  // ...
  new_skill: {
    id: 'new_skill',
    name: '–ù–û–í–´–ô –ù–ê–í–´–ö',
    category: 'cogito',
    color: '#3B82F6',
    description: '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞',
    icon: 'üéØ',
  },
}
```

2. –î–æ–±–∞–≤—å—Ç–µ –≤ `STARTING_SKILLS` (server/src/lib/gameProgress.ts)

3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —Å–æ–≤–µ—Ç–∞—Ö:
```typescript
characterAdvices: [
  {
    characterId: 'new_skill',
    text: '–°–æ–≤–µ—Ç –æ—Ç –Ω–æ–≤–æ–≥–æ –Ω–∞–≤—ã–∫–∞',
    minSkillLevel: 20,
  },
]
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–æ–≤–µ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ choices**
- –ì–æ–ª–æ—Å–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ **–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è**
- –ú–æ–∂–Ω–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏** –≥–æ–ª–æ—Å–∞–º–∏ –ø–µ—Ä–µ–¥ –≤—ã–±–æ—Ä–æ–º
- –°–∏—Å—Ç–µ–º–∞ **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** –∏–≥—Ä–æ–∫–∞ ‚Äî –º–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

## üêõ –û—Ç–ª–∞–¥–∫–∞

–í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
- `üé≠ [VN ViewModel]` ‚Äî –ª–æ–≥–∏–∫–∞ —Å—Ü–µ–Ω
- `üñºÔ∏è [VN Screen]` ‚Äî UI —Å—Ü–µ–Ω—ã
- `üí¨ [Consultation]` ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- `üìä` ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/widgets/visual-novel/VNScreen.tsx` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `src/pages/VisualNovelPage.tsx` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ skills/flags
- `src/shared/types/visualNovel.ts` ‚Äî —Ç–∏–ø—ã
- `server/src/api/routes/vn.ts` ‚Äî –±—ç–∫–µ–Ω–¥ API
- `src/shared/data/visualNovel/testSceneWithAdvices.ts` ‚Äî –ø—Ä–∏–º–µ—Ä

