import type { CoopQuestNode } from '../shared/types/coop';

export const COOP_PROLOGUE_NODES: Record<string, CoopQuestNode> = {
    prologue_start: {
        id: 'prologue_start',
        title: 'Пролог: Эра Безмолвной Горы',
        description: `
Шауинсланд — проклятая гора, где первозданная магия веками пожирала сама себя. Дворфы вскрыли её изнутри и построили **Жар‑Кузню** — вертикальную мега‑крепость, кузницу артефактов Эльфийской Империи.

Потом пришли войны, падение и запретный ритуал: лич‑командир **вживил Проклятое Сердце в ядро горы**. Руны ожили ловушками, големы стали чудовищами, Жар‑Кузня умерла — превратилась в данжен.

У подножия вырос **Фрайбург** — свободный город, питающийся опасностью и превращающий некро‑энергию в ману. Когда Разломы стали стабильными, Гора проснулась снова.
`,
        interactionType: 'sync',
        choices: [{ id: 'next_ch1', text: 'Далее', nextNodeId: 'chapter_1_sparks' }],
    },

    chapter_1_sparks: {
        id: 'chapter_1_sparks',
        title: 'Глава I: Первые искры',
        description: `
Первые контакты между мирами были не героикой, а ошибками.

Патруль FJR в руинах химзавода увидел эльфа‑следопыта в изумрудной вспышке — и выстрелил. На другой стороне Разлома эльф увидел «железного демона» и ответил стрелой.

А где‑то между этим — мальчик, который «ел свет» и оставлял за собой кристаллы.
`,
        interactionType: 'sync',
        choices: [{ id: 'next_ch2', text: 'Далее', nextNodeId: 'chapter_2_crisis' }],
    },

    chapter_2_crisis: {
        id: 'chapter_2_crisis',
        title: 'Глава II: Кризис',
        description: `
Хаос‑Эманация усилила Проклятое Сердце. Ночи над Фрайбургом стали багровыми. Походы в данжен превратились в самоубийство, а экономика — в панику.

И в этот момент на востоке поднимается Новый Оркостан. Их цель — Фрайбург и Проклятая Гора.
`,
        interactionType: 'sync',
        choices: [{ id: 'next_ch3', text: 'Далее', nextNodeId: 'chapter_3_council' }],
    },

    chapter_3_council: {
        id: 'chapter_3_council',
        title: 'Глава III: Экстренное собрание',
        description: `
Ратхаус. Одна красная точка на карте Шлосберга — стабильный Разлом.

Хольц (FJR) требует “выжженной земли”. Артисанты хотят понять. Торговцы хотят продать. Анархист Один кладёт на стол хитин с руническими царапинами и говорит: “они умные”.

Аурелия VoX принимает решение: нужны добровольцы без знамён.

Так появляются **сталкеры**.
`,
        interactionType: 'sync',
        choices: [{ id: 'to_project', text: 'Проект «Шлосберг»', nextNodeId: 'project_schlossberg' }],
    },

    project_schlossberg: {
        id: 'project_schlossberg',
        title: 'Глава IV: Проект «Шлосберг»',
        description: `
Неофициально — «Ночная смена».

Командир: капитан Прайс («Ворон»).
Научный специалист: гном Гюнтер («Нуль»).
Штурмовая группа: вы.

Задача не героическая: **войти, увидеть, выжить, вернуться**.
`,
        interactionType: 'sync',
        choices: [{ id: 'go_outpost', text: 'К аванпосту', nextNodeId: 'outpost_tent' }],
    },

    outpost_tent: {
        id: 'outpost_tent',
        title: 'Аванпост FJR, 5:30',
        description: `
Дождь стучит по брезенту. В палатке пахнет антисептиком и озоном.

Прайс в штурмовом костюме спорит с Нулём — рыжебородым гномом, который едва достаёт до стола, но ведёт себя так, будто командует орбитальной станцией.

На ящиках сидит четвёрка «Ночной смены»:
Ева «Валькирия» Ковальова — хирург.
Йоханн «Vorschlag» Эйзенхауэр — артисаны, инженер‑богатырь.
Дитрих «Ghost» Хаген — бывший снайпер FJR.
Агата «Шустрая» Вольф — анархистка и импровизатор.
`,
        privateText: {
            ghost: '«Угол 45. Пуля .338 войдёт ему в правое лёгкое. Чистый выстрел». Ты ненавидишь, что мозг считает так быстро.',
            valkyrie: '«Да, это больно. А ты думала, в сказку попала?» Ты слышишь свой собственный голос — слишком спокойный.',
            vorschlag:
                '«Слышишь этот тихий свист? Это не подшипник. Это конденсатор плачет». Ты машинально проверяешь крепления на своей разгрузке — руки просят работы.',
            shustrya: '«Эй, командир, не будь таким серьёзным. От этого морщины появляются». Шутка — это тоже броня.',
        },
        interactionType: 'sync',
        choices: [{ id: 'to_briefing', text: 'Слушать брифинг', nextNodeId: 'briefing_orders' }],
    },

    briefing_orders: {
        id: 'briefing_orders',
        title: 'Инструктаж',
        description: `
**Прайс:** «Разведка. Данные. Выжить».

На столе — четыре сканера **«Око»** и один коммуникатор **«Эхо‑5»**.

**Нуль:** «Навести. Нажать. Красный — плохо. Зелёный — возможно, тоже плохо, но медленнее».

**Прайс:** «Вопросы?»
`,
        interactionType: 'sync',
        choices: [{ id: 'questions', text: 'Задать вопросы', nextNodeId: 'briefing_questions' }],
    },

    briefing_questions: {
        id: 'briefing_questions',
        title: 'Вопросы?',
        description: `
Шанс уточнить детали — или промолчать.
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'q_acid',
                text: 'Тактика: «Сэр, кислота — химия или биология?»',
                effectText:
                    'Прайс: «Не знаю. Броня не растворилась — потекла, как воск. Похоже на биологию. Берите нейтрализующий гель и стимы регена».',
                nextNodeId: 'move_out',
            },
            {
                id: 'q_drones',
                text: 'Инфо: «Почему пропали дроны?»',
                effectText: 'Прайс: «Шли по кабелю. Кабель нашли порванным. Всё».',
                nextNodeId: 'move_out',
            },
            {
                id: 'q_pathogens',
                text: '[VALKYRIE] Медицина: «Патогены/споры по ту сторону известны?»',
                requiredRole: 'valkyrie',
                effectText: 'Прайс: «Дышать можно. Фильтры не снимать». Нуль: «Фон странный. Просто… другой».',
                nextNodeId: 'move_out',
            },
            {
                id: 'q_silent',
                text: 'Промолчать',
                effectText: 'Иногда молчание — лучшая маскировка.',
                nextNodeId: 'move_out',
            },
        ],
    },

    move_out: {
        id: 'move_out',
        title: 'Проверка связи',
        description: `
Полог палатки откидывается. Снаружи — колючая проволока, мокрая выжженная земля и оплавленные панцири тварей.

В сером рассвете выше по склону зияет **Разлом**. От него идёт гул, который давит на грудь.

**Прайс:** «Двигаемся. Держимся кучно».
`,
        interactionType: 'sync',
        choices: [{ id: 'move', text: 'К Разлому', nextNodeId: 'approach_climb' }],
    },

    approach_climb: {
        id: 'approach_climb',
        title: 'Подъём',
        description: `
Под ногами хрустят ветки… и мелкие красные кристаллы.

Нуль: «Сканировать всё».
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'scan_crystals',
                text: 'Просканировать кристаллы',
                effectText:
                    '«Око»: органика + минерал. Похоже на кровь, “схваченную” полем Разлома в твёрдую форму.',
                nextNodeId: 'rift_face',
            },
            {
                id: 'scan_moss',
                text: 'Просканировать светящийся мох',
                effectText: '«Око»: активные споры. Мох растёт на металле и обожжённом камне.',
                nextNodeId: 'rift_face',
            },
            {
                id: 'scan_biometrics',
                text: '[VALKYRIE] Просканировать биометрию команды',
                requiredRole: 'valkyrie',
                effectText:
                    'Пульс у всех повышен. Гул Разлома — не звук, а давление на нервную систему: тревога “вшита” в тело.',
                nextNodeId: 'rift_face',
            },
            {
                id: 'scan_skip',
                text: 'Не отвлекаться',
                effectText: 'Иногда лучше видеть, чем измерять.',
                nextNodeId: 'rift_face',
            },
        ],
    },

    rift_face: {
        id: 'rift_face',
        title: 'Порог',
        description: `
Разлом — как зеркало, в котором нет твоего отражения. Прайс проверяет его стволом, потом рукой.

Нуль: «Порог — просто черта».

И шагает внутрь первым.
`,
        interactionType: 'sync',
        choices: [{ id: 'cross', text: 'Пересечь грань', nextNodeId: 'rift_cross_choice' }],
    },

    rift_cross_choice: {
        id: 'rift_cross_choice',
        title: 'Шаг за грань',
        description: `
Как ты входишь?
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'cross_step',
                text: 'Решительный шаг',
                effectText: 'Мир ломается — и собирается заново.',
                nextNodeId: 'other_side',
            },
            {
                id: 'cross_scan',
                text: 'Медленно, со сканером',
                effectText: 'Сенсоры захлёбываются данными. Голова кружится — но запись идёт.',
                nextNodeId: 'other_side',
            },
            {
                id: 'cross_pulse',
                text: '[VALKYRIE] Сверить пульс прямо перед входом',
                requiredRole: 'valkyrie',
                effectText: '110. Высоко, но терпимо. Ты шагаешь.',
                nextNodeId: 'other_side',
            },
            {
                id: 'cross_phrase',
                text: '[SHUSTRAYA] Произнести короткую фразу/молитву',
                requiredRole: 'shustrya',
                effectText: 'Слова держат тебя, пока мир пытается разорвать на части.',
                nextNodeId: 'other_side',
            },
            {
                id: 'cross_cover',
                text: '[GHOST] Войти последним, прикрывая остальных',
                requiredRole: 'ghost',
                effectText: 'Ты входишь в неизвестность с оружием наготове.',
                nextNodeId: 'other_side',
            },
        ],
    },

    other_side: {
        id: 'other_side',
        title: 'По ту сторону',
        description: `
Переход — как если бы тебя одновременно утопили и собрали заново из чужого воздуха.

Перед вами — лес, который не должен существовать: светящиеся грибы, листья невозможных цветов, парящие споры. Над головой — багровые облака и **две луны**.

Йоханн «Vorschlag» спотыкается и — пробив перчатку — касается кристаллического нароста в земле.

**Vorschlag:** «Контакт! Прямой кожный контакт!»

**Прайс:** «Сохранять самообладание! Нуль — анализ!»

Нуль проверяет, как будто это лабораторная работа:

**Нуль:** «Кожа цела. Реакции нет. Жить будет».

Прайс поднимается на небольшой холм, смотрит в бинокль… и замирает.

На северо‑западе видны шпили белого камня и хрустальные купола.

**Прайс (по рации):** «Всем внимание. У нас визуальный контакт… с цивилизацией».
`,
        privateText: {
            ghost: 'Красота — это маскировка. Если тут есть город, значит есть и стрелки. Ты считаешь сектора.',
            valkyrie: 'Пси‑давление у Разлома исчезло. Вместо него — ровный фон, широкий, как туман. Он не “бьёт”, он наблюдает.',
            vorschlag:
                'Свет, руны, геометрия… слишком “правильно”, чтобы быть природой. Ты видишь не лес — а механизм. И очень не хочешь, чтобы он включился.',
            shustrya: '«Город» — это не стены. Это правила и ошибки. Здесь можно умереть от слова так же легко, как от клыков.',
        },
        interactionType: 'vote',
        choices: [
            { id: 'vote_scout', text: 'Осмотреться и найти место для лагеря', nextNodeId: 'descent_path_scout' },
            { id: 'vote_traces', text: 'Идти к следам недавнего сражения', nextNodeId: 'descent_path_traces' },
            { id: 'vote_city', text: 'Рискнуть и двинуться в сторону города', nextNodeId: 'descent_path_city' },
        ],
    },

    descent_path_scout: {
        id: 'descent_path_scout',
        title: 'Короткая разведка',
        description: `
**Прайс:** «Осмотрелись — и хватит. Спускаемся и ищем место для лагеря. Нуль, ты ведущий».
`,
        interactionType: 'sync',
        choices: [{ id: 'continue_scout', text: 'Продолжить спуск', nextNodeId: 'descent_incident' }],
    },

    descent_path_traces: {
        id: 'descent_path_traces',
        title: 'Следы боя',
        description: `
Вы сворачиваете к месту, где лес чернеет, как обугленная ткань. В траве — оплавленные панцири, а на хитине — царапины, похожие на руны.

**Нуль:** «Запомнить. Потом… понять».

Прайс возвращает вас на тропу: времени мало.
`,
        interactionType: 'sync',
        choices: [{ id: 'continue_traces', text: 'Продолжить спуск', nextNodeId: 'descent_incident' }],
    },

    descent_path_city: {
        id: 'descent_path_city',
        title: 'К городу',
        description: `
Вы делаете пару осторожных сотен шагов к шпилям. Ветер приносит перезвон — будто металл поёт.

Прайс рубит жестом:

**Прайс:** «Мы не дипломаты. Пока нет. Сначала — место, где можно выжить».
`,
        interactionType: 'sync',
        choices: [{ id: 'continue_city', text: 'Продолжить спуск', nextNodeId: 'descent_incident' }],
    },

    descent_incident: {
        id: 'descent_incident',
        title: 'Пробой',
        description: `
Агата «Шустрая» идёт впереди и даже здесь умудряется говорить так, будто вы на вечеринке, а не на грани.

Она спотыкается о корень и хватает ствол… ладонь попадает на хитиновую пластину лианы‑паразита.

Скрежет рвущегося кевлара.

**Шустрая:** «Контакт! Костюм пробит!»

На ладони — глубокий порез.

**Прайс:** «Сохранять самообладание! Нуль — анализ!»

Прайс смотрит на вас. Твой ход.
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'injury_protocol',
                text: 'По уставу: остановить группу и подойти осторожно',
                effectText:
                    'Ты фиксируешь всех. Подходишь медленно — растение может быть ловушкой. Порез глубокий, но жить можно. Если это не яд.',
                nextNodeId: 'after_vine',
            },
            {
                id: 'injury_remote',
                text: 'Дать команды на расстоянии: пережим, сканирование, периметр',
                effectText:
                    'Ты лечишь дисциплиной: пережим, дыхание, “не дёргайся”, “держи сектор”. Кровь перестаёт течь ручьём — это уже победа.',
                nextNodeId: 'after_vine',
            },
            {
                id: 'injury_medscan',
                text: '[VALKYRIE] Медсканер: быстрый диагноз по ране',
                requiredRole: 'valkyrie',
                effectText:
                    'Кровопотеря умеренная, токсинов нет… пока. Ты герметизируешь перчатку. «Да, это больно. Стисни зубы».',
                nextNodeId: 'after_vine',
            },
            {
                id: 'injury_perimeter',
                text: '[GHOST] Держать лес: расширить периметр и быть готовым к атаке',
                requiredRole: 'ghost',
                effectText:
                    'Ты смотришь в зелень через прицел. Тишина натянута. Если что-то двинется — ты увидишь первым.',
                nextNodeId: 'after_vine',
            },
            {
                id: 'injury_calm',
                text: '[SHUSTRAYA] Успокоить Шуструю и группу',
                requiredRole: 'shustrya',
                effectText:
                    'Ты гасишь панику голосом. Агата перестаёт дёргаться. В такие моменты харизма — это аптечка.',
                nextNodeId: 'after_vine',
            },
        ],
    },

    after_vine: {
        id: 'after_vine',
        title: 'Первая кровь',
        description: `
Нуль сканирует лиану и бурчит:

**Нуль:** «Не яд. Не сейчас. Но… это инструмент. Ловушка».

Перчатку герметизируют, порез обрабатывают. Прайс не повышает голос — он режет воздух командами.
`,
        interactionType: 'sync',
        choices: [{ id: 'to_barrier', text: 'Дальше', nextNodeId: 'barrier_trap' }],
    },

    barrier_trap: {
        id: 'barrier_trap',
        title: 'Невидимая черта',
        description: `
Лес будто разрезан на две части: здесь — дикий, там — слишком спокойный.

**Нуль:** «Стоп. Впереди… магический барьер».

Кристалл вспыхивает — синяя молния бьёт точно в Нуля. Он падает, костюм дымится.

Голоса в рации рвутся.

Камни вокруг светятся и собираются в формы древних стражей.

**Големы.**
`,
        interactionType: 'sync',
        choices: [{ id: 'to_golems', text: 'Действовать!', nextNodeId: 'golem_engagement' }],
    },

    golem_engagement: {
        id: 'golem_engagement',
        title: 'Големы',
        description: `
Каменный кулак поднимается над Прайсом. Рунный жар пульсирует.

Что ты делаешь?
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'golem_cover',
                text: 'Залечь и вести огонь, выигрывая секунды',
                effectText: 'Это не бой. Это торговля секундами.',
                nextNodeId: 'crossroads_silence',
            },
            {
                id: 'golem_panzer',
                text: '[GHOST] Тяжёлый выстрел по ближайшему',
                requiredRole: 'ghost',
                effectText: 'Камень разлетается. А потом ты видишь, сколько их ещё.',
                nextNodeId: 'crossroads_silence',
            },
            {
                id: 'golem_stabilize',
                text: '[VALKYRIE] Рвануть к Нулю: оценить состояние и утащить в укрытие',
                requiredRole: 'valkyrie',
                effectText: 'Пульс есть. Дыхание есть. Жить будет — если вы проживёте ещё минуту.',
                nextNodeId: 'crossroads_silence',
            },
            {
                id: 'golem_command',
                text: '[SHUSTRAYA] Короткие команды: удержать строй',
                requiredRole: 'shustrya',
                effectText: 'Иногда голос — единственный щит, который работает против хаоса.',
                nextNodeId: 'crossroads_silence',
            },
        ],
    },

    crossroads_silence: {
        id: 'crossroads_silence',
        title: 'Перекрёсток слов',
        description: `
Тишина после грома звенит.

Големы замирают в стоп‑кадре. Руны тускнеют. В воздухе пахнет озоном и порохом.

Из‑за деревьев выходят дворфы в тяжёлой броне. Рядом — эльфийка‑маг в плаще ночного цвета, пальцы которой потрескивают синей силой.

Лидер дворфов кричит:

**«Stari!»** (Стой!)

И — вам:

**«Kiu vi estas? Ĵetu la armilojn!»** (Кто вы? Бросайте оружие!)

Прайс шипит:

**Прайс:** «Не стрелять. Держать позиции!»

Дворф снимает шлем. Суровое лицо. Его зовут **Брок**.

Он замечает Нуля без шлема — и замирает.

Прайс достаёт тусклый амулет Аурелии.

Амулет вспыхивает золотом.

Брок хватает себя за грудь: под латной перчаткой — такой же амулет, и он светится в унисон.

Эльфийка — **Лиандриэль** — прищуривается.

Равновесие хрупкое. Одно слово — и оно треснет.
`,
        interactionType: 'sync',
        choices: [{ id: 'to_personal', text: 'Далее', nextNodeId: 'crossroads_personal' }],
    },

    crossroads_personal: {
        id: 'crossroads_personal',
        title: 'Секунда',
        description: `
У вас есть одна секунда, чтобы сделать что‑то “правильно”.
`,
        interactionType: 'individual',
        choices: [
            {
                id: 'personal_v',
                text: '[VALKYRIE] «Валькирия»: проверить Нуля и рану Шустры',
                requiredRole: 'valkyrie',
                effectText:
                    'Ты работаешь на автомате: ожог, пульс, дыхание, герметичность. Нуль хрипит, но в сознании. «Боль — это сигнал, что ты ещё жив».',
                nextNodeId: 'crossroads_vote',
            },
            {
                id: 'personal_j',
                text: '[VORSCHLAG] «Vorschlag»: оценить барьер и источник “Stari”',
                requiredRole: 'vorschlag',
                effectText:
                    'Ты смотришь не на лица — на механизмы. Поле держит големов как стоп‑кран. «Немного магии, немного мата…» — шепчет твой мозг.',
                nextNodeId: 'crossroads_vote',
            },
            {
                id: 'personal_g',
                text: '[GHOST] «Ghost»: взять Брока в прицел и “посчитать выстрел”',
                requiredRole: 'ghost',
                effectText:
                    'Угол. Дистанция. Ветер. Ты уже видишь траекторию — и старую ошибку вместе с ней.',
                nextNodeId: 'crossroads_vote',
            },
            {
                id: 'personal_a',
                text: '[SHUSTRAYA] «Шустрая»: разрядить обстановку дерзкой шуткой',
                requiredRole: 'shustrya',
                effectText:
                    '«Эй, командир, не будь таким серьёзным». Улыбка выходит кривой из‑за боли, но она работает: кто‑то выдыхает.',
                nextNodeId: 'crossroads_vote',
            },
            {
                id: 'personal_silence',
                text: 'Промолчать и дать Прайсу вести разговор',
                effectText: 'Иногда молчание — лучшая маскировка.',
                nextNodeId: 'crossroads_vote',
            },
        ],
    },

    crossroads_vote: {
        id: 'crossroads_vote',
        title: 'Выбор',
        description: `
Брок ждёт. Лиандриэль держит заклинание на кончиках пальцев.

Прайс смотрит на вас через забрало. Без слов.

Как вы разрубаете узел?
`,
        interactionType: 'vote',
        choices: [
            {
                id: 'vote_peace',
                text: 'Вариант 1: Прайс показывает пустые руки и говорит “Мы не враги”',
                nextNodeId: 'crossroads_peace',
            },
            {
                id: 'vote_coerce',
                text: 'Вариант 2: Дать Шустрой сыграть “на грани”',
                nextNodeId: 'crossroads_coerce',
            },
            {
                id: 'vote_massacre',
                text: 'Вариант 3: Разрешить Ghost сделать выстрел',
                nextNodeId: 'crossroads_massacre',
            },
        ],
    },

    crossroads_peace: {
        id: 'crossroads_peace',
        title: 'Мирный исход',
        description: `
Прайс отпускает автомат и поднимает пустые руки.

**Прайс:** «Мы не враги. Этот знак — символ нашей миссии».

Лиандриэль закрывает глаза.

**Лиандриэль:** «Он не лжёт. Только неведение… и страх».

Брок медленно опускает топор.

**Брок:** «Вы пойдёте с нами. Не как пленники. Как… аномалия, которую нужно понять».
`,
        interactionType: 'sync',
        choices: [{ id: 'to_end_peace', text: 'Далее', nextNodeId: 'prologue_end' }],
    },

    crossroads_coerce: {
        id: 'crossroads_coerce',
        title: 'Принуждение к миру',
        description: `
Шустрая дерзит — и равновесие падает.

Брок кивает Лиандриэль.

Светящиеся корни вырываются из земли и обвивают ваши ноги. Дышать можно, двигаться — нет.

**СТАТУС: ПЛЕННИКИ**
`,
        interactionType: 'sync',
        choices: [{ id: 'to_end_coerce', text: 'Далее', nextNodeId: 'prologue_end' }],
    },

    crossroads_massacre: {
        id: 'crossroads_massacre',
        title: 'Бойня',
        description: `
Ghost делает выстрел.

Пуля бьёт в невидимый барьер перед Броком — вспышка синего: Лиандриэль подняла щит.

Брок не злится. Он решает.

**Брок:** «В бой!»

Дворфы смыкают “стену щитов”. Лиандриэль гасит связь сферой тишины.

Удар. Темнота.

**СТАТУС: ВРАГИ**
`,
        interactionType: 'sync',
        choices: [{ id: 'to_end_massacre', text: 'Далее', nextNodeId: 'prologue_end' }],
    },

    prologue_end: {
        id: 'prologue_end',
        title: 'Конец пролога',
        description: `
Вы ещё живы. Это уже победа.

Но теперь у Разлома появилась вторая сторона — и у неё есть оружие, правила и память.
`,
        interactionType: 'sync',
        choices: [{ id: 'restart', text: 'Начать заново (демо)', nextNodeId: 'prologue_start' }],
    },
};
