–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –¥–≤–æ–π–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (—ç—Ñ—Ñ–µ–∫—Ç ¬´–ø–µ—á–∞—Ç–∞—é—â–µ–π –º–∞—à–∏–Ω–∫–∏¬ª)

–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã: –¢–µ–∫—É—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ –≤ DialogueBox –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏ –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ DialogueBox, VNScreen –∏ ViewModel. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Ñ–ª–∞–≥ isPending (–æ–±–æ–∑–Ω–∞—á–∞—é—â–∏–π –∑–∞–≥—Ä—É–∑–∫—É/–ø–µ—Ä–µ—Ö–æ–¥ —Å—Ü–µ–Ω—ã) –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏.

–õ–æ–≥–∏–∫–∞ DialogueBox: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç DialogueBox –≤ —Å–≤–æ–µ–º —Ö—É–∫–µ useEffect –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—á–∞—Ç–∏:

const shouldSkipTyping = !sanitizedFullText 
   || isPending 
   || (prefersReducedMotion && !forceTypingAnimation)
if (shouldSkipTyping) {
    log('‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏', { ..., isPending })
    setDisplayedText(effectiveText)
    setIsTyping(false)
    notifyRevealComplete()
    return
}
// –∏–Ω–∞—á–µ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∫–∞–¥—Ä–æ–≤—É—é –ø–µ—á–∞—Ç—å...


–≠—Ç–æ—Ç –∫–æ–¥ –æ–∑–Ω–∞—á–∞–µ—Ç: –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–µ–π—á–∞—Å –∏–¥—ë—Ç ¬´–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π¬ª –ø–µ—Ä–µ—Ö–æ–¥ —Å—Ü–µ–Ω—ã (isPending == true) –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á—ë–ª –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ (–∏ –º—ã –Ω–µ —Ñ–æ—Ä—Å–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é) ‚Äì –Ω–µ –ø–µ—á–∞—Ç–∞–π –ø–æ–∫–∞–¥—Ä–æ–≤–æ, –∞ —Å—Ä–∞–∑—É –æ—Ç–æ–±—Ä–∞–∑–∏ –≤–µ—Å—å —Ç–µ–∫—Å—Ç
GitHub
. –ü—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç notifyRevealComplete() ‚Äì –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–±—ç–∫, —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω–∞.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å—Ü–µ–Ω—ã: –í–æ ViewModel –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ–≤–æ–π —Å—Ü–µ–Ω–µ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ concurrent transition —á–µ—Ä–µ–∑ startTransition. –í –∫–æ–¥–µ useVisualNovelViewModel –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å—Ü–µ–Ω—ã (goToScene) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è React-—Ö—É–∫ useTransition
GitHub
. –≠—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ isPending = true –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–π —Å—Ü–µ–Ω—ã. –ü–æ–∫–∞ isPending true, DialogueBox –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—á–∞—Ç—å –∏ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç, –ª–æ–≥–∏—Ä—É—è —Å–æ–±—ã—Ç–∏–µ ¬´–ø—Ä–æ–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏¬ª
GitHub
. –ó–∞—Ç–µ–º, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (isPending —Å–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ false), —Ç–æ—Ç –∂–µ text –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ DialogueBox —É–∂–µ –ø—Ä–∏ isPending = false, –∏ —ç—Ñ—Ñ–µ–∫—Ç useEffect –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ. –ü–æ—Å–∫–æ–ª—å–∫—É —Ç–µ–∫—Å—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å isPending –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, —Ö—É–∫ —Å–Ω–æ–≤–∞ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è: –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ shouldSkipTyping false, –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ —Å –Ω—É–ª—è
GitHub
. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ —Ä–µ–ø–ª–∏–∫–∞ —Å–Ω–∞—á–∞–ª–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –∑–∞—Ç–µ–º —Ç—É—Ç –∂–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∏ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –ø–æ –±—É–∫–≤–∞–º ‚Äì –≤–∏–∑—É–∞–ª—å–Ω–æ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ ¬´–¥—ë—Ä–≥–∞–Ω–∏–µ¬ª —Ç–µ–∫—Å—Ç–∞.

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö: –õ–æ–≥–∏, –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—ã–µ –≤ –≤–æ–ø—Ä–æ—Å–µ, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —ç—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç. –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞ –ø–µ—á–∞—Ç–∏ (‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏) –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–µ–∫—Å—Ç–∞ (‚è≠Ô∏è –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–µ–∫—Å—Ç–∞), –∑–∞—Ç–µ–º —Å—Ä–∞–∑—É —Å–ª–µ–¥—É–µ—Ç –Ω–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏ (‚å®Ô∏è –ù–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏) –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ç–æ–ø/–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–∏. –≠—Ç–∏ –¥–≤–æ–π–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É.

–î–≤–æ–π–Ω—ã–µ –≤—ã–∑–æ–≤—ã onAdvance: –ö—Ä–æ–º–µ isPending, –Ω–∞ –¥–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä –≤–ª–∏—è—é—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –∫–ª–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í VNScreen —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 900 –º—Å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ñ—Ä–∞–∑—ã, –µ—Å–ª–∏ –Ω–µ—Ç –≤—ã–±–æ—Ä–∞
GitHub
. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞. –ö–æ–¥ handleAdvance –≤–Ω—É—Ç—Ä–∏ DialogueBox —Ä–∞–∑–ª–∏—á–∞–µ—Ç –¥–≤–∞ —Å–ª—É—á–∞—è
GitHub
: –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –µ—â—ë –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è (isTyping), –∫–ª–∏–∫ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—á–∞—Ç–∏ (‚ö° –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—á–∞—Ç–∏ –ø–æ –∫–ª–∏–∫—É) —Å –ø–æ–ª–Ω—ã–º —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ–º —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ revealImmediately()
GitHub
, –Ω–æ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–ø–ª–∏–∫–µ. –õ–∏—à—å —Å–ª–µ–¥—É—é—â–∏–π –∫–ª–∏–∫ (–∫–æ–≥–¥–∞ isTyping=false) –≤—ã–∑—ã–≤–∞–µ—Ç onAdvance –∏ –º–µ–Ω—è–µ—Ç —Å—Ç—Ä–æ–∫—É. –ï—Å–ª–∏ –∂–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ (onAdvance –∏–∑ —Ç–∞–π–º–µ—Ä–∞ –≤ VNScreen), –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π: —Å–Ω–∞—á–∞–ª–∞ –∫–ª–∏–∫ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é (–ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ç–∞–π–º–µ—Ä–∞
GitHub
), –∑–∞—Ç–µ–º –ø–æ—á—Ç–∏ —Å—Ä–∞–∑—É onAdvance –∏–∑ –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Å–º–µ–Ω—É —Ä–µ–ø–ª–∏–∫–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ —Ç–æ–º—É, —á—Ç–æ –Ω–∞ —Å—Ç—ã–∫–µ —Ä–µ–ø–ª–∏–∫ –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∏ —Ç—É—Ç –∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.

–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –°–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–∞–∑–∞ —Ç–µ–∫—Å—Ç–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

DialogueBox —Ö—Ä–∞–Ω–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ displayedText –∏ isTyping –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–ª–±—ç–∫ onRevealComplete –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–µ—á–∞—Ç–∏.

VNScreen —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ isLineRevealed (—á–µ—Ä–µ–∑ setLineRevealed(true) –≤ –∫–æ–ª–±—ç–∫–µ onRevealComplete) –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–≥–æ —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥
GitHub
GitHub
.

ViewModel —É–ø—Ä–∞–≤–ª—è–µ—Ç currentLine –∏ —Ñ–ª–∞–≥–æ–º isPending (—á–µ—Ä–µ–∑ useTransition)
GitHub
, –∞ —Ç–∞–∫–∂–µ –ª–æ–≥–∏–∫–æ–π goNext/choose –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—é–∂–µ—Ç—É.

SessionStore —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã (—Ñ–ª–∞–≥–∏, –æ–ø—ã—Ç –∏ –ø—Ä.) –≥–ª–æ–±–∞–ª—å–Ω–æ, –Ω–æ –Ω–∞ —Å–∞–º —Ä–µ–Ω–¥–µ—Ä DialogueBox –≤–ª–∏—è–Ω–∏—è –Ω–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é.

–ò–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å—Ç—Ä–æ–≥–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ isPending –≤ ViewModel –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–ø—É—Å–∫—É –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ DialogueBox, –∞ –µ–≥–æ —Å–Ω—è—Ç–∏–µ ‚Äì –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É, —Ö–æ—Ç—è —Ç–µ–∫—Å—Ç —Ä–µ–ø–ª–∏–∫–∏ –Ω–µ –º–µ–Ω—è–ª—Å—è. –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –¥–µ—Ñ–µ–∫—Ç —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–í—ã–≤–æ–¥: –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –¥–µ—Ä–≥–∞–Ω–∏–π ‚Äì –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —ç—Ñ—Ñ–µ–∫—Ç–∞ ¬´–ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏¬ª –Ω–∞ –æ–¥–Ω—É —Ä–µ–ø–ª–∏–∫—É, –≤—ã–∑–≤–∞–Ω–Ω—ã–π —Å–º–µ–Ω–æ–π isPending –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–æ–º. –ù–∞–ª–∏—Ü–æ –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ —Ç–µ–º, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç DialogueBox —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º, –∞ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ–ª–∞–≥–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞.

2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏

–¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

–ò—Å–∫–ª—é—á–∏—Ç—å –¥–≤–æ–π–Ω–æ–π –∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ä–µ–ø–ª–∏–∫—É.

–ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã –≤–æ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏.

–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ä—ã–≤–∫–æ–≤.

–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useEffect –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ useRef –¥–ª—è –º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

2.1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–º —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–∫—Å—Ç–∞. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –∑–∞–ø—É—Å–∫–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–∞–º–æ–π —Ä–µ–ø–ª–∏–∫–∏, –∞ –Ω–µ –∏–∑-–∑–∞ –ø–æ–±–æ—á–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤. –í —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —è–≤–ª—è—é—Ç—Å—è –∏ text, –∏ isPending, –∏ –¥—Ä. ‚Äì –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ —Å–º–µ–Ω–µ isPending, –¥–∞–∂–µ –µ—Å–ª–∏ text –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
GitHub
. –†–µ—à–µ–Ω–∏–µ: —É–±—Ä–∞—Ç—å isPending –∏–∑ —Å–ø–∏—Å–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ª–∏–±–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å usePrevious –∏–ª–∏ —Ä–µ—Ñ, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –∏ –µ—Å–ª–∏ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–ø—É—Å–∫–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ text —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∏ —É–∂–µ –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω, —Ç–æ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é. –ü—Å–µ–≤–¥–æ–∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞:

const prevTextRef = useRef<string>('')
...
useEffect(() => {
   if (text === prevTextRef.current && !isTyping) {
      // –¢–µ–∫—É—â–∞—è —Ä–µ–ø–ª–∏–∫–∞ —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ —Ä–∞–Ω–µ–µ, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –Ω—É–∂–µ–Ω
      return 
   }
   prevTextRef.current = text
   ... // –¥–∞–ª–µ–µ –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—á–∞—Ç–∏
}, [text /* –±–µ–∑ isPending */])


–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ–≥–¥–∞ –∏–∑-–∑–∞ —Å–º–µ–Ω—ã isPending —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ ¬´–Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å¬ª —É–∂–µ –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –í–º–µ—Å—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è isPending, –º–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫–∞–∑ –Ω–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ñ–∞–∫—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∞–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

2.2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—á–∞—Ç–∏ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ü–µ–Ω—ã. –í –º–æ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–π —Å—Ü–µ–Ω—ã –º–æ–∂–Ω–æ –≤–æ–≤—Å–µ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω—ã. –°–µ–π—á–∞—Å —Ç–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–π —Ä–µ–ø–ª–∏–∫–∏ –Ω–æ–≤–æ–π —Å—Ü–µ–Ω—ã –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑-–∑–∞ isPending, –∞ –∑–∞—Ç–µ–º –∞–Ω–∏–º–∏—Ä—É–µ—Ç—Å—è. –ë–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ: –ª–∏–±–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–µ–ø–ª–∏–∫—É, –ø–æ–∫–∞ isPending (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã), –ª–∏–±–æ —Å—Ä–∞–∑—É –Ω–∞—á–∞—Ç—å –µ—ë –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–æ—â–µ ‚Äì –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –≤ VNScreen: –µ—Å–ª–∏ isPending, –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å DialogueBox –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å—Ü–µ–Ω—ã. –û–¥–Ω–∞–∫–æ —ç—Ç–æ –º–æ–∂–µ—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥–∞. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –æ—Å—Ç–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥, –Ω–æ —É–±—Ä–∞—Ç—å –∏–∑ DialogueBox —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ isPending. –í –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–º –∫–æ–¥–µ DialogueBox –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ isPending –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏—è –æ –ø–µ—á–∞—Ç–∏, –ø–æ–ª–∞–≥–∞—è—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ prefers-reduced-motion –∏ –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É –∞–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å—Ä–∞–∑—É –Ω–∞—á–Ω—ë—Ç—Å—è (—á—Ç–æ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –ø—Ä–∏–µ–º–ª–µ–º–æ, —Ç.–∫. –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ü–µ–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–æ, –∞ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–≤–æ–π —Ä–µ–ø–ª–∏–∫–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω). –ì–ª–∞–≤–Ω–æ–µ ‚Äì —É–±—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏–µ, –≤—ã–∑—ã–≤–∞—é—â–µ–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∫–∞–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Ñ–ª–∞–≥—É isPending.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ï—Å–ª–∏ –≤—Å—ë –∂–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∫—Ä—ã—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≤—Ä–µ–º—è –¥–æ–ª–≥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞), –ª—É—á—à–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º –∏–∑–≤–Ω–µ: –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é currentLine –≤ VNScreen, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≥–æ—Ç–æ–≤—ã. –¢–æ–≥–¥–∞ DialogueBox –Ω–µ –ø–æ–º–µ–Ω—è–µ—Ç text –∏ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç —ç—Ñ—Ñ–µ–∫—Ç, –ø–æ–∫–∞ —Å—Ü–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.

2.3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é useRef. –°–µ–π—á–∞—Å –∫–∞–∂–¥—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ setDisplayedText, –≤—ã–∑—ã–≤–∞—è —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–∏–º–≤–æ–ª–µ (–ø–æ—Ä—è–¥–∫–∞ 30 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)
GitHub
. –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è React-—Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∏–º–≤–æ–ª–µ. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

–•—Ä–∞–Ω–∏—Ç—å DOM-—ç–ª–µ–º–µ–Ω—Ç –∞–±–∑–∞—Ü–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ—Ñ–µ (const textRef = useRef<HTMLParagraphElement>(null)).

–í —Ü–∏–∫–ª–µ typeNext –Ω–∞–ø—Ä—è–º—É—é –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∏–º–≤–æ–ª –∫ textRef.current —á–µ—Ä–µ–∑ textContent –∏–ª–∏ insertAdjacentText. –¢–∞–∫–æ–π –ø—Ä—è–º–æ–π –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ DOM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —Ç.–∫. –æ—Å—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.

–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≤—ã–∑–≤–∞–≤ –æ–¥–∏–Ω setDisplayedText(fullText) –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–∏–ª–∏ –≤–æ–≤—Å–µ –¥–µ—Ä–∂–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–µ—Ñ–µ, –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è).

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ —Ä–µ–∞–∫—Ç–æ–≤—Å–∫–∏—Ö —Ä–µ–Ω–¥–µ—Ä–æ–≤. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç DialogueBox –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–ø–ª–∏–∫–∏, –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª. –°–æ—Å—Ç–æ—è–Ω–∏—è displayedText –∏ isTyping –≤—Å—ë –µ—â—ë –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤–≤–æ–¥–∞ –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è, –Ω–æ –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–µ —Å—Ç–æ–ª—å —á–∞—Å—Ç–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, isTyping –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å true –≤ –Ω–∞—á–∞–ª–µ –∏ false –≤ –∫–æ–Ω—Ü–µ, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∞ displayedText –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–ª–Ω—É—é —Å—Ç—Ä–æ–∫—É.

–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ä–µ—Ñ:

const textParagraphRef = useRef<HTMLParagraphElement>(null);

// ... –≤–Ω—É—Ç—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏:
if (!shouldSkipTyping) {
   textParagraphRef.current!.textContent = '' 
   // ... –≤–Ω—É—Ç—Ä–∏ typeNext:
   textParagraphRef.current!.textContent += characters[index]
}


React –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞, –Ω–æ —á–µ—Ä–µ–∑ —Ä–µ—Ñ –º—ã –∏–∑–±–µ–≥–∞–µ–º 30+ –≤—ã–∑–æ–≤–æ–≤ setState. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∞–Ω–∏–º–∞—Ü–∏—è —Å—Ç–∞–Ω–µ—Ç –ø–ª–∞–≤–Ω–µ–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞, –∏ —Å–Ω–∏–∑–∏—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ reconciliation. –ü—Ä–∏ —ç—Ç–æ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ onRevealComplete –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —É–≤–µ–¥–æ–º–∏—Ç —Å–∏—Å—Ç–µ–º—É, –∫–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç –¥–æ–ø–µ—á–∞—Ç–∞–Ω.

2.4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –∏ –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤. –¢–µ–∫—É—â–∏–π –∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç clearTimer() —á–µ—Ä–µ–∑ —Ä–µ—Ñ timeoutRef –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—á–∏—â–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã –≤ cleanup —ç—Ñ—Ñ–µ–∫—Ç–∞
GitHub
 –∏ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
GitHub
. –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã –ø–µ—Ä–µ–π–¥—ë–º –Ω–∞ requestAnimationFrame –≤–º–µ—Å—Ç–æ setTimeout –∏–ª–∏ –±—É–¥–µ–º –∏–Ω–∞—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ü–∏–∫–ª–æ–º –ø–µ—á–∞—Ç–∏, –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–µ–Ω –Ω–∞–¥—ë–∂–Ω—ã–π —Å–±—Ä–æ—Å, —á—Ç–æ–±—ã –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω–µ —Ä–µ–ø–ª–∏–∫ —Ñ–æ–Ω–æ–≤—ã–µ —Ç–∞–π–º–µ—Ä—ã –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ —Ä–∞–±–æ—Ç—É. –°–ª–µ–¥—É–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª—é–±–æ–µ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ (–ø–æ –∫–ª–∏–∫—É –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥—É —Å—Ü–µ–Ω—ã) –≤—ã–∑—ã–≤–∞–µ—Ç clearTimer(). –í –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–º handleAdvance —ç—Ç–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç—Å—è: –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–æ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è revealImmediately(), –∫–æ—Ç–æ—Ä—ã–π –æ—á–∏—â–∞–µ—Ç —Ç–∞–π–º–µ—Ä –∏ —Å—Ä–∞–∑—É –¥–æ–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç
GitHub
. –≠—Ç–∏ —á–∞—Å—Ç–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –ª–∏—à—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–≤ –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª—å—à–µ state –Ω–∞ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª, revealImmediately –ø—Ä–æ—Å—Ç–æ –≤—ã—Å—Ç–∞–≤–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –≤—ã–∑–æ–≤–µ—Ç onRevealComplete).

2.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π useEffect. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –º–∞—Å—Å–∏–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–Ω—É—Ç—Ä–∏. –í –Ω–æ–≤–æ–º –∫–æ–¥–µ —ç—Ç–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –±—É–¥–µ—Ç [text, prefersReducedMotion] (–∏, –≤–æ–∑–º–æ–∂–Ω–æ, forceTypingAnimation –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è). –ù–µ –≤–∫–ª—é—á–∞–π—Ç–µ —Ç—É–¥–∞ –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è log –º–æ–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ –æ–±–µ—Ä–Ω—É—Ç—å –≤ useCallback, –∫–∞–∫ –∏ —Å–¥–µ–ª–∞–Ω–æ (—á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫)
GitHub
. –¢–æ –∂–µ –∫–∞—Å–∞–µ—Ç—Å—è notifyRevealComplete –∏ –¥—Ä—É–≥–∏—Ö callback‚Äô–æ–≤ ‚Äì –æ–Ω–∏ –ª–∏–±–æ –æ–±—ë—Ä–Ω—É—Ç—ã –≤ useCallback, –ª–∏–±–æ –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã. –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —ç—Ñ—Ñ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ text (—Ä–µ–ø–ª–∏–∫–∏) –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–Ω–∏–º–∞—Ü–∏–∏, –∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö.

2.6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏: –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

–ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ–≤–æ–π —Å—Ü–µ–Ω–µ —Å –ø–µ—Ä–≤–æ–π —Ä–µ–ø–ª–∏–∫–æ–π: —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—á–∞—Ç–∞—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –±–µ–∑ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è. –í –ª–æ–≥–∞—Ö –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –ù–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏ –¥–ª—è –ø–µ—Ä–≤–æ–π —Ä–µ–ø–ª–∏–∫–∏ —Å—Ü–µ–Ω—ã.

–û–±—ã—á–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–ø–ª–∏–∫–µ –≤–Ω—É—Ç—Ä–∏ —Å—Ü–µ–Ω—ã (goNext): –ø–µ—á–∞—Ç—å –∏–¥—ë—Ç —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑.

–ö–ª–∏–∫ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–µ–º—É—Å—è —Ç–µ–∫—Å—Ç—É: —Ç–µ–∫—Å—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–ª–æ–≥ ‚ö° –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—á–∞—Ç–∏ –ø–æ –∫–ª–∏–∫—É), –∏ –ø–æ –≤—Ç–æ—Ä–æ–º—É –∫–ª–∏–∫—É —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–ø–ª–∏–∫–µ. –ù–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —É–∂–µ –¥–æ–ø–µ—á–∞—Ç–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ (auto-advance) –±–µ–∑ –≤—ã–±–æ—Ä–∞: –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–µ—á–∞—Ç–∏ (onRevealComplete) –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä –∏ —á–µ—Ä–µ–∑ 900 –º—Å –≤—ã–∑—ã–≤–∞—Ç—å onAdvance. –ï—Å–ª–∏ –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω–µ—Ç, —Ç–∞–π–º–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è (üßπ –û—Ç–º–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö)
GitHub
 –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (–¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–µ–∫—Å—Ç–∞ –∏ —Ç.–ø.).

Prefers-reduced-motion: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É ¬´–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ —É–º–µ–Ω—å—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏¬ª –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ forceTypingAnimation=false —Ç–µ–∫—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º —Å—Ä–∞–∑—É (–ø—Ä–æ–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏), –∞ –ø—Ä–∏ forceTypingAnimation=true ‚Äì –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –ø–µ—á–∞—Ç—å, –Ω–æ –±–µ–∑ –¥–µ—Ä–≥–∞–Ω–∏–π.

–û—Ç–ª–∞–∂–∏–≤–∞—è —ç—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –≤—ã —É–≤–µ—Ä–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ.

3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤—ã–±–æ—Ä–æ–≤ (Choice Effects)

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏. –≠—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –æ–±—ä–µ–∫—Ç–µ choice.effects —Ç–∏–ø–∞ VisualNovelChoiceImpact (—Å—É–¥—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é: –ø–æ–ª—è addFlags, removeFlags, xp, reputation –∏ —Ç.–¥.)
GitHub
. –ù–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π:

–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (stat modifiers, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ buff/debuff).

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.

–°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤.

–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è/affinity).

3.1. –î–∏–∑–∞–π–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤. –í–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –≤–≤–µ—Å—Ç–∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤—ã–±–æ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Ö–æ–¥ —Å –¥–∏—Å—Ä–∏–º–∏–Ω–∏—Ä—É—é—â–∏–º —Ç–∏–ø–æ–º (discriminated union) –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä:

type ChoiceEffect = 
  | { type: 'stat_modifier'; stat: string; delta: number; duration?: number } 
  | { type: 'add_item'; itemId: string; quantity: number }
  | { type: 'add_quest'; questId: string; questData?: object }
  | { type: 'relationship_change'; characterId: string; delta: number };


–ó–¥–µ—Å—å —É –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ type —Å–≤–æ–π –Ω–∞–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π. –¢–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –≤ –±—É–¥—É—â–µ–º. –ü–æ–ª–µ duration –¥–ª—è stat_modifier –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äì –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, —ç—Ñ—Ñ–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–π—Å—Ç–≤—É–µ—Ç N —Å—Ü–µ–Ω –∏–ª–∏ –º–∏–Ω—É—Ç), –∏–Ω–∞—á–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π. questData –º–æ–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–≤–µ–¥–µ–Ω–∏–π –æ –∫–≤–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —ç—Ç–∞–ø—ã –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ).

–ú—ã –º–æ–∂–µ–º –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ VisualNovelChoice —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–æ —Å–æ–¥–µ—Ä–∂–∞–ª–æ —Å–ø–∏—Å–æ–∫ —ç—Ç–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤:

interface VisualNovelChoice {
    id: string;
    text: string;
    nextLineId?: string;
    nextSceneId?: string;
    effects?: ChoiceEffect[];  // –∑–∞–º–µ–Ω—è–µ–º –∏–ª–∏ –¥–æ–ø–æ–ª–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}


–ï—Å–ª–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ choice.effects —É–∂–µ –æ–±—ä–µ–∫—Ç, –º–æ–∂–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤ effects: ChoiceEffect[]. –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è (flags, xp) –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞:

addFlags: ['flag1'] —Å—Ç–∞–Ω–µ—Ç { type: 'stat_modifier', stat: 'flag1', delta: 1 } –µ—Å–ª–∏ —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ –∫–∞–∫ –±–∏–Ω–∞—Ä–Ω—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É, –∏–ª–∏ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–ª–∞–≥–∏ –æ—Ç–¥–µ–ª—å–Ω–æ.

xp: 10 —Å—Ç–∞–Ω–µ—Ç { type: 'stat_modifier', stat: 'xp', delta: 10 } (–ª–∏–±–æ –æ—Å—Ç–∞–≤–∏—Ç—å xp –æ—Ç–¥–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –æ–Ω –æ—Å–æ–±—ã–π).

reputation: [{ faction: 'X', delta: 5 }] –º–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ { type: 'relationship_change', characterId/faction: 'X', delta: 5} ‚Äì –µ—Å–ª–∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ —Ñ—Ä–∞–∫—Ü–∏—è–º = –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –≥—Ä—É–ø–ø–∞–º–∏.

–î–ª—è —è—Å–Ω–æ—Å—Ç–∏, –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∏–º–µ–Ω–Ω–æ –∫–∞–∫ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã. –ü—Ä–∏–º–µ—Ä: –≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã:

effects: [
   { type: 'add_item', itemId: 'potion_healing', quantity: 2 },
   { type: 'stat_modifier', stat: 'health', delta: 20 },
   { type: 'add_quest', questId: 'find_amulet' },
   { type: 'relationship_change', characterId: 'npc_alice', delta: -10 }
]


–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –¥–∞—Ç—å –∏–≥—Ä–æ–∫—É 2 –∑–µ–ª—å—è –ª–µ—á–µ–Ω–∏—è, —É–≤–µ–ª–∏—á–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ 20 (buff), –Ω–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç ¬´find_amulet¬ª, —Å–Ω–∏–∑–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –ê–ª–∏—Å–∞ –Ω–∞ 10.

3.2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (applyEffects). –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ. –í ViewModel —Å–µ–π—á–∞—Å applyEffects(choice) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ flags
GitHub
. –ú—ã –∑–∞–º–µ–Ω–∏–º/–¥–æ–ø–æ–ª–Ω–∏–º –µ—ë —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–∞—Å—Å–∏–≤–∞ ChoiceEffect:

const applyEffects = (effects: ChoiceEffect[]) => {
   for (const effect of effects) {
      switch (effect.type) {
         case 'stat_modifier':
            applyStatModifier(effect.stat, effect.delta, effect.duration)
            break
         case 'add_item':
            inventoryStore.addItem(effect.itemId, effect.quantity)
            log(`–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ–¥–º–µ—Ç ${effect.itemId} x${effect.quantity}`)
            break
         case 'add_quest':
            questStore.startQuest(effect.questId, effect.questData)
            log(`–ù–∞—á–∞—Ç –∫–≤–µ—Å—Ç ${effect.questId}`)
            break
         case 'relationship_change':
            relationshipStore.modifyRelation(effect.characterId, effect.delta)
            log(`–ò–∑–º–µ–Ω–µ–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å ${effect.characterId} –Ω–∞ ${effect.delta}`)
            break
      }
   }
}


–≠—Ç–∞ –ø—Å–µ–≤–¥–æ-—Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞–º:

–°—Ç–∞—Ç—ã: applyStatModifier ‚Äì —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–π–¥—ë—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (stat) –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –∏–∑–º–µ–Ω–∏—Ç –µ—ë. –ï—Å–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π, –æ–Ω–∞ –∂–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –Ω–∞ —Å–Ω—è—Ç–∏–µ —á–µ—Ä–µ–∑ duration. –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ñ—Ñ—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, —á—Ç–æ–±—ã –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–º–µ–Ω—è—Ç—å –∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–º–µ–Ω—å—à–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ). –ù–æ –µ—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–µ–π—Å—Ç–≤—É—é—Ç –Ω–µ–¥–æ–ª–≥–æ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π —Å—Ü–µ–Ω—ã –∏–ª–∏ —ç–ø–∏–∑–æ–¥–∞), –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–≥—Ä–æ–∫–∞ –∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ü–µ–Ω—ã –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å. –í –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äì –∏–º–µ—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

–ü—Ä–µ–¥–º–µ—Ç—ã: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞. –ó–¥–µ—Å—å —É–º–µ—Å—Ç–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Zustand-—Å—Ç–æ—Ä–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞) ‚Äì inventoryStore.addItem. –ï—Å–ª–∏ —Ç–∞–∫–æ–≥–æ –µ—â—ë –Ω–µ—Ç, –Ω—É–∂–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (id –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) –∏ –º–µ—Ç–æ–¥—ã addItem/removeItem. –í—ã–±–æ—Ä, –¥–∞—é—â–∏–π –ø—Ä–µ–¥–º–µ—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç addItem, –∞ UI –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Å–º–æ–∂–µ—Ç –ø–æ—Ç–æ–º –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã.

–ö–≤–µ—Å—Ç—ã: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∫–≤–µ—Å—Ç–æ–≤. –ú–µ—Ç–æ–¥ startQuest –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –∫–≤–µ—Å—Ç–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–±—ä–µ–∫—Ç–µ quests —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ¬´–≤–∑—è—Ç–æ¬ª) –∏–ª–∏ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–≤–µ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã, questData –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–ª–∏, –∏–ª–∏ –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∫–≤–µ—Å—Ç–æ–≤ –∏ –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—Ç–∏—Ç—å –µ–≥–æ –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π.

–û—Ç–Ω–æ—à–µ–Ω–∏—è: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É reputation –¥–ª—è —Ñ—Ä–∞–∫—Ü–∏–π, –ª–∏–±–æ –≤–≤–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, relationshipStore –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å { characterId: score }. –ú–µ—Ç–æ–¥ modifyRelation(id, delta) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç/—É–º–µ–Ω—å—à–∞–µ—Ç –æ—á–∫–∏. –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ñ—Ä–∞–∫—Ü–∏—è–º, –º–æ–∂–Ω–æ, –∫–∞–∫ –≤—ã –æ—Ç–º–µ—Ç–∏–ª–∏, —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å —Ñ—Ä–∞–∫—Ü–∏—é –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, faction "ThievesGuild" –∏–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ "npc_alice" ‚Äì –ø–æ —Å—É—Ç–∏ –æ–±–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏). –í —Ç–µ–∫—É—â–µ–º SessionStore —Ä–µ–ø—É—Ç–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ pendingReputation: Record<string, number>
GitHub
GitHub
 ‚Äì —ç—Ç–æ, –ø–æ —Å—É—Ç–∏, —É–∂–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –í–µ—Ä–æ—è—Ç–Ω–æ, —Ç—É–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∏ –ø–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–æ–ª—è: –∑–∞–Ω–æ—Å–∏—Ç—å —Ç—É–¥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ NPC (–ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä npc_alice: -10). –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ –ø—Ä–∏–¥—ë—Ç—Å—è –¥–∞–∂–µ –∑–∞–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–π store ‚Äì –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤ recordChoice –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ç–∞–∫ –∂–µ, –∫–∞–∫ —Ä–µ–ø—É—Ç–∞—Ü–∏—é.

3.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SessionStore (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤). –¢–µ–∫—É—â–∏–π Zustand-—Å—Ç–æ—Ä useVisualNovelSessionStore —Å–æ–±–∏—Ä–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã –≤—ã–±–æ—Ä–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ recordChoice
GitHub
. –û–Ω —É–∂–µ —Å—É–º–º–∏—Ä—É–µ—Ç addFlags, removeFlags, pendingXp –∏ pendingReputation. –ü—Ä–∏–¥—ë—Ç—Å—è —Ä–∞—Å—à–∏—Ä–∏—Ç—å –µ–≥–æ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:

–§–ª–∞–≥–∏ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—è: –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å. –û–Ω–∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Å–≤—è–∑–∞–Ω—ã —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–≥—Ä–æ–∫–∞ (—Ñ–ª–∞–≥–∏ —Å—é–∂–µ—Ç–Ω—ã–µ, —Ä–µ–ø—É—Ç–∞—Ü–∏—è —Å —Ñ—Ä–∞–∫—Ü–∏—è–º–∏).

–ü—Ä–µ–¥–º–µ—Ç—ã: –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Å–∏–≤ pendingItems: { itemId: string; quantity: number }[] –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –í recordChoice, –ø—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–µ add_item, –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤ (–º–æ–∂–Ω–æ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ—Ç –∂–µ –ø—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑). –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ü–µ–Ω—ã –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ payload –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–∏–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞.

–ö–≤–µ—Å—Ç—ã: –¥–æ–±–∞–≤–∏—Ç—å pendingQuests: string[] ‚Äì —Å–ø–∏—Å–æ–∫ ID –∫–≤–µ—Å—Ç–æ–≤, –Ω–∞—á–∞—Ç—ã—Ö (–∏–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö) –≤ —Ö–æ–¥–µ —Å—Ü–µ–Ω—ã. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–µ add_quest. –°–µ—Ä–≤–µ—Ä, –ø–æ–ª—É—á–∏–≤ payload, –æ—Ç–º–µ—Ç–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç–∞–º –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞.

–û—Ç–Ω–æ—à–µ–Ω–∏—è: –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pendingReputation –∫–∞–∫ —É–ø–æ–º—è–Ω—É—Ç–æ, –ª–∏–±–æ –∑–∞–≤–µ—Å—Ç–∏ pendingRelations: Record<string, number> –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –û–¥–Ω–∞–∫–æ, –ø–æ—Å–∫–æ–ª—å–∫—É pendingReputation —É–∂–µ –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–∞–º–∏, –º–æ–∂–Ω–æ –Ω–µ —Ä–∞–∑–ª–∏—á–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é ‚Äì –ø—Ä–æ—Å—Ç–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –∫–ª—é—á–µ–π –¥–ª—è NPC vs —Ñ—Ä–∞–∫—Ü–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–ª—é—á–∏ –≤–∏–¥–∞ "npc:alice" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ ‚Äì —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—Å—ë —Ä–∞–≤–Ω–æ, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—É–±—ä–µ–∫—Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —ç—Ñ—Ñ–µ–∫—Ç relationship_change —Å–≤–æ–¥–∏—Ç—Å—è –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∑–∞–ø–∏—Å–∏ –≤ pendingReputation. –í –∫–æ–¥–µ recordChoice —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π applyReputation
GitHub
GitHub
, –∫–æ—Ç–æ—Ä–∞—è, –≤–∏–¥–∏–º–æ, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Ç–∏–ø–∞ { faction, delta }. –ú—ã –º–æ–∂–µ–º —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å characterId –∫–∞–∫ faction –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –¢–æ –µ—Å—Ç—å, —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–∏–ø –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ choice.effects.reputation —Å–æ–¥–µ—Ä–∂–∏—Ç entries, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö —Ç—É–¥–∞. –¢–æ–≥–¥–∞ –Ω–∏–∫–∞–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –Ω–µ –Ω—É–∂–Ω–æ ‚Äì —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —É–∂–µ —Å–ª–æ–∂–∏—Ç –≤—Å—ë –≤ pendingReputation.

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏—è recordChoice –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫ (–ø—Å–µ–≤–¥–æ–∫–æ–¥):

recordChoice: ({ sceneId, lineId, choice }) => set((state) => {
    let newAddFlags = state.pendingAddFlags
    let newRemoveFlags = state.pendingRemoveFlags
    let newItems = state.pendingItems
    let newQuests = state.pendingQuests
    let newXp = state.pendingXp
    let newRep = { ...state.pendingReputation }

    for (const eff of choice.effects || []) {
        switch(eff.type) {
          case 'stat_modifier':
            // —Ñ–ª–∞–≥–∏ –∫–∞–∫ –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π —Å—Ç–∞—Ç–æ–≤:
            if (eff.stat.startsWith('flag:')) {
               const flagName = eff.stat.slice(5)
               if (eff.delta > 0) newAddFlags = uniquePush(newAddFlags, flagName)
               if (eff.delta < 0) newRemoveFlags = uniquePush(newRemoveFlags, flagName)
            }
            if (eff.stat === 'xp') {
               newXp += eff.delta
            }
            // –ø—Ä–æ—á–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ —Å–µ—Å—Å–∏–∏
            break;
          case 'add_item':
            newItems = addToItemsList(newItems, eff.itemId, eff.quantity)
            break;
          case 'add_quest':
            newQuests = uniquePush(newQuests, eff.questId)
            break;
          case 'relationship_change':
            const key = eff.characterId
            newRep[key] = (newRep[key] ?? 0) + eff.delta
            break;
        }
    }

    const entry: SessionChoiceEntry = { sceneId, lineId, choiceId: choice.id, effects: choice.effects, timestamp: Date.now() }
    log('‚úÖ –í—ã–±–æ—Ä –∑–∞–ø–∏—Å–∞–Ω...', { choiceId: choice.id, addFlagsDelta: ..., xpDelta: ..., itemsDelta: ..., questsDelta: ... })
    return {
       choices: [...state.choices, entry],
       pendingAddFlags: newAddFlags,
       pendingRemoveFlags: newRemoveFlags,
       pendingXp: newXp,
       pendingReputation: newRep,
       pendingItems: newItems,
       pendingQuests: newQuests
    }
})


–§—É–Ω–∫—Ü–∏–∏ uniquePush –∏ –ø–æ–¥–æ–±–Ω—ã–µ ‚Äì —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
GitHub
. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (log) —Ç–æ–∂–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è, —á—Ç–æ–±—ã –æ—Ç—Ä–∞–∑–∏—Ç—å –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –Ω–∞—á–∞—Ç—ã—Ö –∫–≤–µ—Å—Ç–æ–≤). –í –∏—Ç–æ–≥–µ, –∫–æ–≥–¥–∞ —Å—Ü–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è consumePayload, –º—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π —ç—Ç–∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è:

{
  sceneId: ..., startedAt: ..., finishedAt: ...,
  visitedScenes: [...],
  choices: [...],            // –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–æ–≤
  addFlags: [...], removeFlags: [...],
  xpDelta: ...,
  reputation: { ... },       // –≤–∫–ª—é—á–∞—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è
  items: [ {itemId, qty}, ... ],
  quests: [...],
}


–≠—Ç–æ—Ç payload —É—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
GitHub
GitHub
, –≥–¥–µ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞, –æ—Ç–º–µ—Ç–∏—Ç—å –∫–≤–µ—Å—Ç—ã –Ω–∞—á–∞—Ç—ã–º–∏, –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—ã/—Ä–µ–ø—É—Ç–∞—Ü–∏—é –∏ —Ç.–¥. ‚Äì —Å–æ–≥–ª–∞—Å–Ω–æ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–µ.

3.4. –°–≤—è–∑—å —Å UI –∏ –±–∞–ª–∞–Ω—Å–æ–º –∏–≥—Ä—ã. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å UI –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

–ï—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ–¥–º–µ—Ç, –∏ —É –∏–≥—Ä–æ–∫–∞ –æ—Ç–∫—Ä—ã—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å ‚Äì –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç (–∏–ª–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–í—ã –ø–æ–ª—É—á–∏–ª–∏ X¬ª).

–ï—Å–ª–∏ –Ω–∞—á–∞—Ç –∫–≤–µ—Å—Ç ‚Äì –º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ –≤ –∂—É—Ä–Ω–∞–ª –∫–≤–µ—Å—Ç–æ–≤.

–ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ, –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–Ω–æ—à–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Ä—Ç—Ä–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º +/-).
–ü–æ–∫–∞ –º—ã –Ω–µ —É–≥–ª—É–±–ª—è–µ–º—Å—è –≤ —ç—Ç–∏ –¥–µ—Ç–∞–ª–∏, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∑–≤–æ–ª—è—Ç—å —Ç–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –≥–ª–æ–±–∞–ª—å–Ω—ã–π inventoryStore –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–π React-–∫–æ–Ω—Ç–µ–∫—Å—Ç, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —É–∑–Ω–∞—é—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, questStore –∏ relationshipStore –º–æ–≥—É—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–∂–µ—Ç–æ–≤.

–ò—Ç–æ–≥–æ, –º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É, –≥–¥–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤—ã–±–æ—Ä–æ–≤ —è–≤–ª—è—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –º–æ–¥—É–ª—è–º (—Å—Ç–∞—Ç—ã, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –∫–≤–µ—Å—Ç—ã, –æ—Ç–Ω–æ—à–µ–Ω–∏—è). –¢–∞–∫–æ–π –¥–∏–∑–∞–π–Ω –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ –±—É–¥—É—â–µ–º (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –≤ union –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–≥–æ). –ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º: —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª—ã –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç—ã, –Ω–µ –º–µ–Ω—è—è –ª–æ–≥–∏–∫—É ViewModel. ViewModel –∂–µ —Å—Ç–∞–ª —á–∏—â–µ ‚Äì –≤–º–µ—Å—Ç–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é applyEffects(choice.effects), –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—â—É—é –¥–µ—Ç–∞–ª–∏.

4. –°–∏—Å—Ç–µ–º–∞ —Ç–æ—á–µ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ (Map Point Interactions)

–¢–µ–ø–µ—Ä—å —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å: —Ç–æ—Ä–≥–æ–≤—Ü—ã, –∫—É–∑–Ω–∏—Ü—ã (—É–ª—É—á—à–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è), —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏, NPC –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –∏ –ø—Ä–æ—á. –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è ‚Äì —Å–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π –∏ –º–æ–¥—É–ª—å–Ω–æ–π, —á—Ç–æ–±—ã –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

4.1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–æ—á–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–í–≤–µ–¥—ë–º –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å MapPointInteraction —Å –ø–æ–ª—è–º–∏, –æ–±—â–∏–º–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤:

interface MapPointInteraction {
  id: string;             // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ—á–∫–∏
  type: 'trade' | 'upgrade' | 'training' | 'dialogue' | string;
  title: string;          // –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI, –Ω–∞–ø—Ä. "–õ–∞–≤–∫–∞ –∫—É–∑–Ω–µ—Ü–∞")
  position?: { x: number; y: number }; // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  // ... –¥—Ä—É–≥–∏–µ –æ–±—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∫–æ–Ω–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ)
}


–î–∞–ª–µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–æ–ª–µ data. –ë–æ–ª–µ–µ —è–≤–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äì –∑–∞–≤–µ—Å—Ç–∏ –ø–æ–¥—Ç–∏–ø—ã:

interface TradeInteraction extends MapPointInteraction {
  type: 'trade';
  npcId: string;
  inventory: Item[];        // —Ç–æ–≤–∞—Ä—ã NPC
  currency: string;         // –≤–∞–ª—é—Ç–∞ —Å–¥–µ–ª–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'gold')
}
interface UpgradeInteraction extends MapPointInteraction {
  type: 'upgrade';
  npcId: string;
  upgradeOptions: UpgradeOption[]; // –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
}
interface TrainingInteraction extends MapPointInteraction {
  type: 'training';
  trainerId: string;
  skillsOffered: SkillType[];    // –∫–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –º–æ–∂–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å
  costPerSession: number;
}
interface DialogueInteraction extends MapPointInteraction {
  type: 'dialogue';
  sceneId: string;    // –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ü–µ–Ω—ã/–¥–∏–∞–ª–æ–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
}


–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å union —Ç–∏–ø MapPoint = TradeInteraction | UpgradeInteraction | TrainingInteraction | DialogueInteraction. –í –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞—è—Ö, –æ–¥–Ω–∞–∫–æ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤ MapPointInteraction –∏–º–µ—Ç—å –ø–æ–ª–µ type –∏ data: any. –ù–∞–ø—Ä–∏–º–µ—Ä:

type MapPointType = 'trade' | 'upgrade' | 'training' | 'dialogue'
interface MapPointInteraction {
   id: string;
   type: MapPointType;
   title: string;
   data: any;  // —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ø–µ—Ü. –ø–æ–ª—è –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–∞
}


–ù–∞–ø–æ–ª–Ω—è—è –∫–∞—Ä—Ç—É, –º—ã —Å–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä:

const mapPoints: MapPointInteraction[] = [
  { id: 'blacksmith_shop', type: 'trade', title: '–ö—É–∑–Ω–µ—Ü', data: { npcId: 'smith', inventory: [...], currency: 'gold' } },
  { id: 'training_yard', type: 'training', title: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –¥–≤–æ—Ä', data: { trainerId: 'coach', skillsOffered: ['strength','defense'], costPerSession: 100 } },
  { id: 'town_square', type: 'dialogue', title: '–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å', data: { sceneId: 'town_square_intro' } }
];


–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ JSON/TS-–∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞. –í–∞–∂–Ω–æ, —á—Ç–æ —É –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –µ—Å—Ç—å type, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –¥–∞–ª—å–Ω–µ–π—à–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

4.2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–æ–∑–¥–∞–¥–∏–º —Å–≤–æ–π React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—â–∏–π UI –∏ –ª–æ–≥–∏–∫—É:

<TradeWindow> ‚Äì –æ–∫–Ω–æ —Ç–æ—Ä–≥–æ–≤–ª–∏ (—Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ NPC, –¥–µ–Ω—å–≥–∏ –∏–≥—Ä–æ–∫–∞, –∫–Ω–æ–ø–∫–∏ –∫—É–ø–∏—Ç—å/–ø—Ä–æ–¥–∞—Ç—å).

<UpgradeStation> ‚Äì –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ª—É—á—à–µ–Ω–∏—è —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è (—Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞, –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è, —Ç—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã).

<TrainingModal> ‚Äì –æ–∫–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ (–≤—ã–±–æ—Ä –Ω–∞–≤—ã–∫–∞, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ).

<DialogueScene> ‚Äì –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞/—Å—Ü–µ–Ω—ã (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª—ã: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ü–µ–Ω–µ VN).

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –µ–¥–∏–Ω—ã–π –æ–±–æ–ª–æ—á–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —Ç–∏–ø—É —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–æ–π –ø–æ–¥-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä, MapPointModal:

interface MapPointModalProps { point: MapPointInteraction; onClose: () => void; }
const MapPointModal: React.FC<MapPointModalProps> = ({ point, onClose }) => {
  // –û–±—â–∏–π –∫–∞—Ä–∫–∞—Å –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  return (
    <div className="modal">
      <h2>{point.title}</h2>
      { point.type === 'trade' && <TradeWindow npcId={point.data.npcId} inventory={point.data.inventory} onClose={onClose} /> }
      { point.type === 'upgrade' && <UpgradeStation npcId={point.data.npcId} options={point.data.upgradeOptions} onClose={onClose} /> }
      { point.type === 'training' && <TrainingModal trainerId={point.data.trainerId} skills={point.data.skillsOffered} cost={point.data.costPerSession} onClose={onClose} /> }
      { point.type === 'dialogue' && <DialogueScene sceneId={point.data.sceneId} onFinish={onClose} /> }
    </div>
  );
};


–ó–¥–µ—Å—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ç–æ—á–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è ¬´–Ω–∞—á–∏–Ω–∫–∞¬ª. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è: –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π —Ç–∏–ø (type: 'puzzle' –Ω–∞–ø—Ä–∏–º–µ—Ä), –º—ã –ø–∏—à–µ–º <PuzzleComponent ... /> –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ—â—ë –æ–¥–Ω—É –≤–µ—Ç–∫—É.

–ö–∞–∂–¥—ã–π –ø–æ–¥-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

TradeWindow: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç npcId –∏ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤. –û–Ω –º–æ–∂–µ—Ç –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –∏–∑ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞ –∏ –¥–µ–Ω—å–≥–∏. –í–Ω—É—Ç—Ä–∏ ‚Äì —Ä–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, –≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏), –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∂–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ). –¢–∞–∫–∂–µ ‚Äì –∫–Ω–æ–ø–∫–∏ ¬´–ö—É–ø–∏—Ç—å¬ª/¬´–ü—Ä–æ–¥–∞—Ç—å¬ª. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, inventoryStore.buyItem(npcId, itemId, qty), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∏—Ç –¥–µ–Ω—å–≥–∏, —É–º–µ–Ω—å—à–∏—Ç –¥–µ–Ω—å–≥–∏, –¥–æ–±–∞–≤–∏—Ç –ø—Ä–µ–¥–º–µ—Ç –∏–≥—Ä–æ–∫—É, –∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å –∑–∞–ø–∞—Å —É NPC. –≠—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º store –∏–ª–∏ —Ä–∞–∑–±–∏—Ç—ã: –¥–µ–Ω—å–≥–∏ ‚Äì –≤ playerStore, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å ‚Äì –≤ inventoryStore, —Ç–æ–≤–∞—Ä—ã NPC ‚Äì –≤ –∫–∞–∫–æ–º-—Ç–æ merchantStore –∏–ª–∏ –¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ TradeWindow (—Ä–∞–∑ NPC –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∑–∞–¥–∞–Ω –≤ data).

UpgradeStation: –ø–æ—Ö–æ–∂–∏–π UI, –Ω–æ —Å–ø–∏—Å–æ–∫ ‚Äì —ç—Ç–æ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∞–ø–≥—Ä–µ–π–¥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–µ–¥–º–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å). –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ ‚Äì –≤—ã–∑–≤–∞—Ç—å inventoryStore.upgradeItem(itemId, upgradeId), –∫–æ—Ç–æ—Ä–∞—è —Å–ø–∏—à–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –∑–∞–º–µ–Ω–∏—Ç/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–º–µ—Ç.

TrainingModal: –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–≤—ã–∫–æ–≤ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –∫–Ω–æ–ø–∫—É ¬´–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è¬ª. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ‚Äì —Å–ø–∏—Å–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–æ–ª–æ—Ç–æ –∏–ª–∏ –æ—á–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏), —É–≤–µ–ª–∏—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –Ω–∞–≤—ã–∫ –∏–≥—Ä–æ–∫–∞ (playerStatsStore.increase('strength')), –∏ –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–Ω–∞–≤—ã–∫ —É–ª—É—á—à–µ–Ω¬ª.

DialogueScene: –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ —Ç–∞–∫—É—é —Ç–æ—á–∫—É –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É VN —Å –Ω—É–∂–Ω–æ–π —Å—Ü–µ–Ω–æ–π: navigate('/visual-novel?sceneId=' + point.data.sceneId). –ü–æ—Å–∫–æ–ª—å–∫—É —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç VisualNovelPage/Experience, –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å: –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ DialogueInteraction ‚Äì —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å <VNScreen> –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∞. –û–¥–Ω–∞–∫–æ, –ª—É—á—à–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å VN. –ü–æ—ç—Ç–æ–º—É, –≤–æ–∑–º–æ–∂–Ω–æ, DialogueInteraction –Ω–µ —á–µ—Ä–µ–∑ –æ–±—â–∏–π –º–æ–¥–∞–ª, –∞ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–º (—Å–æ—Ö—Ä–∞–Ω–∏–≤, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è). –í –ø—Ä–æ—Å—Ç–æ–º —Å–ª—É—á–∞–µ —Å–¥–µ–ª–∞–µ–º –∫–∞–∫ –≤ —Å–ø–∏—Å–∫–µ –≤—ã—à–µ: <DialogueScene sceneId={...} onFinish={onClose} /> ‚Äì —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è —Ä–µ–Ω–¥–µ—Ä–∏—Ç VisualNovelExperience –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π —Å—Ü–µ–Ω–æ–π, –∞ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ isSceneCompleted —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è true) –≤—ã–∑—ã–≤–∞–µ—Ç onFinish, –∑–∞–∫—Ä—ã–≤–∞—è –º–æ–¥–∞–ª. –¢–∞–∫–æ–π –¥–∏–∞–ª–æ–≥ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—Ä–≥–æ–≤–µ—Ü —Å–Ω–∞—á–∞–ª–∞ –∑–¥–æ—Ä–æ–≤–∞–µ—Ç—Å—è ‚Äì –¥–∏–∞–ª–æ–≥, –ø–æ—Ç–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ—Ä–≥–æ–≤–ª—è).

4.3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —ç—Ç–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. –ï—Å—Ç—å –¥–≤–∞ —É—Ä–æ–≤–Ω—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:

–ì–ª–æ–±–∞–ª—å–Ω–æ–µ (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ) —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞, –µ–≥–æ –¥–µ–Ω—å–≥–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–æ–≤ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π ‚Äì –≤—Å—ë, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–æ—Å–µ—â–µ–Ω–∏—è–º–∏ —Ç–æ—á–µ–∫. –î–ª—è —ç—Ç–æ–≥–æ —É –Ω–∞—Å –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Zustand-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

useInventoryStore ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —É –∏–≥—Ä–æ–∫–∞ –∏ –º–µ—Ç–æ–¥—ã addItem, removeItem, buyItem, sellItem.

usePlayerStatsStore ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–æ–ª–æ—Ç–æ (gold), –≤–æ–∑–º–æ–∂–Ω–æ, —É—Ä–æ–≤–Ω–∏ –Ω–∞–≤—ã–∫–æ–≤ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

useQuestStore ‚Äì —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö/–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤.

useRelationshipStore ‚Äì –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å NPC (–∏–ª–∏ —ç—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å —Ä–µ–ø—É—Ç–∞—Ü–∏–µ–π).

–≠—Ç–∏ —Å—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å, –∏–ª–∏ –º—ã –¥–æ–±–∞–≤–∏–º –∏—Ö. –°–∞–º–∏ –ø–æ —Å–µ–±–µ —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç —Ç–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äì –æ–Ω–∏ –∏—Ö –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç.

–õ–æ–∫–∞–ª—å–Ω–æ–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ) —Å–æ—Å—Ç–æ—è–Ω–∏–µ UI: –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä –≤—ã–±—Ä–∞–Ω, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–∞–µ–º–æ–≥–æ —Ç–æ–≤–∞—Ä–∞, –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è, –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª–æ—Å—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ —Ç.–ø. –≠—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –∏ –Ω–µ –Ω—É–∂–Ω—ã –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –æ–∫–Ω–∞. –¢—É—Ç –º–æ–∂–Ω–æ —Å–º–µ–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useState –≤–Ω—É—Ç—Ä–∏ TradeWindow/UpgradeStation –¥–ª—è —Ç–∞–∫–∏—Ö —Ü–µ–ª–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, const [selectedItem, setSelectedItem] = useState<Item|null>(null) –≤–Ω—É—Ç—Ä–∏ TradeWindow –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.

–ü—Ä–∏–º–µ—Ä ‚Äì TradeWindow –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:

const TradeWindow: React.FC<{ npcId: string; inventory: Item[]; onClose: () => void }> = ({ npcId, inventory, onClose }) => {
   const playerGold = usePlayerStatsStore(state => state.gold)
   const addItem = useInventoryStore(state => state.addItem)
   const [selectedItem, setSelectedItem] = useState<Item|null>(null)
   const [quantity, setQuantity] = useState(1)
   
   const handleBuy = () => {
      if (!selectedItem) return
      const cost = selectedItem.price * quantity
      if (playerGold < cost) {
         alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!")
         return
      }
      // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      usePlayerStatsStore.getState().spendGold(cost)
      addItem(selectedItem.id, quantity)
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ —É NPC, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
      // ...
      console.log(`–ö—É–ø–ª–µ–Ω ${selectedItem.name} x${quantity}`)
   }

   return (
      <div className="trade-ui">
         <ul>
           {inventory.map(item => (
             <li key={item.id} onClick={() => setSelectedItem(item)}>
                {item.name} ‚Äì {item.price} –∑–æ–ª.
             </li>
           ))}
         </ul>
         {selectedItem && (
           <div className="details">
             <p>–í—ã –≤—ã–±—Ä–∞–ª–∏: {selectedItem.name}</p>
             <input type="number" value={quantity} min={1} max={99} onChange={e => setQuantity(+e.target.value)} />
             <button onClick={handleBuy}>–ö—É–ø–∏—Ç—å</button>
           </div>
         )}
         <button onClick={onClose}>–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
   )
}


–ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π usePlayerStatsStore –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è playerGold –∏ –º–µ—Ç–æ–¥ —Ç—Ä–∞—Ç–∏—Ç—å –∑–æ–ª–æ—Ç–æ (spendGold), –∞ useInventoryStore –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–≥—Ä–æ–∫—É. –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ, –∫–æ–Ω–µ—á–Ω–æ, –ª—É—á—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞ —É NPC –∏ —É–º–µ–Ω—å—à–∞—Ç—å –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É (–≤—ã–≤–æ–¥ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–æ–ª–æ—Ç–∞).

4.4. –°–≤—è–∑—å —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–æ–π. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç WorldMap, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π –∫–∞—Ä—Ç—É —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏. –û–Ω –º–æ–∂–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∫–æ–Ω–æ–∫/–∫–Ω–æ–ø–æ–∫ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö, –∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –Ω–∏—Ö –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

const WorldMap: React.FC = () => {
   const [activePoint, setActivePoint] = useState<MapPointInteraction|null>(null)
   return (
     <div className="map">
       {mapPoints.map(point => (
         <button key={point.id} style={{ left: point.position.x, top: point.position.y }} 
                 onClick={() => setActivePoint(point)}>
           {point.title}
         </button>
       ))}
       {activePoint && 
         <MapPointModal point={activePoint} onClose={() => setActivePoint(null)} />
       }
     </div>
   )
}


–ó–¥–µ—Å—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–æ—á–∫—É –æ—Ç–∫—Ä–æ–µ—Ç—Å—è MapPointModal —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–≥—Ä–æ–∫ –∑–∞–∫—Ä—ã–ª –æ–∫–Ω–æ —Ç–æ—Ä–≥–æ–≤–ª–∏), onClose —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç activePoint, –∏ –æ–∫–Ω–æ –∏—Å—á–µ–∑–∞–µ—Ç.

4.5. –î–∏–∞–ª–æ–≥–∏ –≤ —Ç–æ—á–∫–∞—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –ï—Å–ª–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ—á–µ–∫ –≤–∞–∂–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ –≤–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—Ä–≥–æ–≤–µ—Ü –º–æ–∂–µ—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è –∏ —Å–ø—Ä–æ—Å–∏—Ç—å, —á—Ç–æ –Ω—É–∂–Ω–æ ‚Äì ¬´–ö—É–ø–∏—Ç—å/–ü—Ä–æ–¥–∞—Ç—å/–£–π—Ç–∏¬ª), —É –Ω–∞—Å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

–°—Ü–µ–Ω–∞—Ä–∏–∏ VN –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à—É —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é VN-—Å–∏—Å—Ç–µ–º—É. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—á–∫–∞ blacksmith_shop –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ü–µ–Ω—É –¥–∏–∞–ª–æ–≥–∞ (sceneId: 'smith_greeting'), –≥–¥–µ —Ä–µ–ø–ª–∏–∫–∏: ¬´–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, —Å—Ç—Ä–∞–Ω–Ω–∏–∫! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?¬ª –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã: ¬´–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã¬ª, ¬´–£–ª—É—á—à–∏—Ç—å —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ¬ª, ¬´–ù–∏—á–µ–≥–æ¬ª. –í—ã–±–æ—Ä ¬´–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã¬ª –º–æ–≥ –±—ã –∑–∞–≤–µ—Ä—à–∞—Ç—å —Å—Ü–µ–Ω—É –∏ –∑–∞—Ç–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç TradeWindow. –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Å–≤—è–∑–∫–∏: –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤—ã–∑–≤–∞—Ç—å onClose —É DialogueScene –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π UI. –°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, ViewModel VN –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å callback —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–µ–π. –û–¥–Ω–∞–∫–æ, –ø—Ä–æ—â–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫–∏–µ –≤—ã–±–æ—Ä—ã –ø—Ä—è–º–æ –≤ UI TradeWindow (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–±—ã ¬´–î–∏–∞–ª–æ–≥¬ª –∏ ¬´–¢–æ—Ä–≥–æ–≤–ª—è¬ª), –Ω–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–µ.

–†–∞–∑ —É–∂ —É –Ω–∞—Å –º–æ—â–Ω—ã–π VN-–¥–≤–∏–∂–æ–∫, –ª–æ–≥–∏—á–Ω–æ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä–æ–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏-—Å—Ü–µ–Ω—ã –¥–ª—è NPC. –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äì –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è VN-—Å—Ü–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–æ–π –≤—ã–±–æ—Ä –±—ã–ª —Å–¥–µ–ª–∞–Ω. –ï—Å–ª–∏ –≤—ã–±–æ—Ä ¬´—Ç–æ—Ä–≥–æ–≤–ª—è¬ª, —Ç–æ —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã—Ç—å TradeWindow. –ú–æ–∂–Ω–æ –≤ onChoiceApplied (–∫–æ–ª–±—ç–∫, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –µ—Å—Ç—å —É useVisualNovelViewModel
GitHub
) –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤—ã–±–æ—Ä –∏ –≤—ã–∑–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ choice.id === 'open_trade', –∑–∞–∫—Ä—ã—Ç—å VN –∏ –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ —Ç–æ—Ä–≥–æ–≤–ª–∏.

–ü—Ä–æ—â–µ: –ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—Ç—Å—è —Å–º–µ—à–∏–≤–∞—Ç—å VN –∏ UI, –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ –¥–µ—Ä–µ–≤—å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ TradeWindow –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ stage: 'greeting' | 'trading', –∏ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∫–Ω–æ–ø–∫–∏ ¬´—Ç–æ—Ä–≥–æ–≤–∞—Ç—å / —É–π—Ç–∏¬ª. –≠—Ç–æ –≤—Ä—É—á–Ω—É—é –¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å VN, –Ω–æ –∏–Ω–æ–≥–¥–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–π. –û–¥–Ω–∞–∫–æ, —Ç–∞–∫–æ–π –ø—É—Ç—å –º–µ–Ω–µ–µ —É–¥–æ–±–µ–Ω –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç–æ–≤ (–ª–æ–≥–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–∞ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É).

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VN-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è —É—Å–ª–æ–≤–∏—è, —Ä–∞–∑–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ –æ—Ç —Ñ–ª–∞–≥–æ–≤, –∏ —Ç.–¥. ‚Äì —Ç–æ, –≤ —á—ë–º —Å–∏–ª—ë–Ω –≤–∞—à VN-–¥–≤–∏–∂–æ–∫. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö UI (—Ç–æ—Ä–≥–æ–≤–ª—è, –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –ø—Ä.), –∫—É–¥–∞ VN –Ω–µ –ø—Ä–∏—Å–ø–æ—Å–æ–±–ª–µ–Ω. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Ç–æ—Ä–≥–æ–≤—Ü–∞.

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è VN-—Å—Ü–µ–Ω–∞ smith_intro ‚Äì –¥–∏–∞–ª–æ–≥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Å –≤—ã–±–æ—Ä–æ–º.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç ¬´–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã¬ª.

VN-—Å—Ü–µ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–ª–±—ç–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ onChoiceApplied –∏–ª–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —Å—Ü–µ–Ω—ã) ‚Äì –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –Ω–∞–¥–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ—Ä–≥–æ–≤–æ–µ –æ–∫–Ω–æ.

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è TradeWindow (–º–æ–¥–∞–ª—å–Ω–æ). –î–∏–∞–ª–æ–≥–æ–≤—ã–π —Ñ–æ–Ω –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å (–∏–ª–∏ —Å—Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∞).

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ—Ä–≥—É–µ—Ç, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ.

(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∏–≥—Ä–æ–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ –¥–∏–∞–ª–æ–≥, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ—â–∞–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ, –Ω–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ—Ç ‚Äì –ø–æ—Å–ª–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–∏–∞–ª–æ–≥ —É–∂–µ –Ω–µ –Ω—É–∂–µ–Ω.

–≠—Ç–∞ —Å—Ö–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π ¬´–∫–ª–µ–π–∫–æ–π¬ª –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É VN –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏. –ú–æ–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π Zustand –¥–ª—è —ç—Ç–æ–≥–æ: –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≤ VN —Å—Ç–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ uiState = { tradeOpen: true }. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é onChoiceApplied –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ NPC-—Å—Ü–µ–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –∏ –æ—Ç–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ. –í –≤–∞—à–µ–º –∫–æ–¥–µ —É–∂–µ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä: onChoiceApplied –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ VisualNovelExperience –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤—ã–±–æ—Ä–∞ –≤ —Å–µ—Å—Å–∏—é
GitHub
. –¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å: if (choice.id === 'open_trade') setActivePoint(tradePoint).

4.6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ç–æ—Ä–≥–æ–≤–ª–∏/—É–ª—É—á—à–µ–Ω–∏–π/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞:

–¢–æ—Ä–≥–æ–≤–ª—è: –ü–æ–º–∏–º–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏ –∑–æ–ª–æ—Ç–∞, –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ NPC. –ï—Å–ª–∏ –∫–∞–∂–¥—ã–π —Ç–æ—Ä–≥–æ–≤–µ—Ü –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤, –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ç–æ—á–∫–∏ (–∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –≤ data.inventory). –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è (—Ä–∞—Å–ø—Ä–æ–¥–∞–Ω—ã, –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º), –Ω–∞–¥–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–µ. –ù–∞—á–Ω—ë–º —Å –ø—Ä–æ—Å—Ç–æ–≥–æ: —Ç–æ–≤–∞—Ä—ã –∑–∞–¥–∞–Ω—ã —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –º—ã –º–æ–∂–µ–º –ª–æ–∫–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å quantity —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –µ–≥–æ, –Ω–æ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞ (–µ—Å–ª–∏ –º—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö). –ú–æ–∂–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å ‚Äì –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å (–µ—Å–ª–∏ –ø–æ –∑–∞–º—ã—Å–ª—É —Ç–æ—Ä–≥–æ–≤–µ—Ü –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø—Ä–æ–¥–∞—ë—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–≤–∞—Ä). –ï—Å–ª–∏ –Ω–∞–¥–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Äì –¥–µ—Ä–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ NPC –≤ useInventoryStore –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º useMerchantStore. –ù–∞–ø—Ä–∏–º–µ—Ä, useMerchantStore —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π { [npcId]: Item[] } –∏ –º–µ—Ç–æ–¥–∞–º–∏ buyItemFrom(npcId, itemId), sellItemTo(npcId, itemId).

–£–ª—É—á—à–µ–Ω–∏–µ: –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞ (–∏—Ö —É—Ä–æ–≤–Ω–∏ —É–ª—É—á—à–µ–Ω–∏–π –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏). –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –ø—Ä–µ–¥–º–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ inventoryStore —Å –ø–æ–ª—è–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, {id, baseAttack, upgradeLevel}. –°–ø–∏—Å–æ–∫ upgradeOptions –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∫–∞–∫ —á–∞—Å—Ç—å UpgradeInteraction.data ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ { itemId: 'sword_iron', upgrades: [ {id: 'sharp', name: '–ó–∞—Ç–æ—á–∏—Ç—å –∫–ª–∏–Ω–æ–∫', cost: 100, newAttack: 15}, ... ] }. –õ–∏–±–æ –æ–ø–∏—Å–∞—Ç—å –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª—é–±–æ–π –º–µ—á –º–æ–∂–Ω–æ –∑–∞—Ç–æ—á–∏—Ç—å +5 –∞—Ç–∞–∫–∏ –∑–∞ 100 –º–æ–Ω–µ—Ç). –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å: –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ UpgradeStation –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–≥—Ä–æ–∫–∞, –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è, –∏ –∫–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–µ—à—å ‚Äì –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–∏–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–∞, –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç—Å—è –æ–ø—Ü–∏–∏. –≠—Ç–æ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–≤—è–∑–∞–Ω –Ω–∞ –¥–∏–∑–∞–π–Ω –∏–≥—Ä—ã. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ: likely –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–∏—Å UpgradeService –∏–ª–∏ —á–∞—Å—Ç—å inventoryStore —Å –ª–æ–≥–∏–∫–æ–π —É–ª—É—á—à–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–µ—Ç–æ–¥ upgradeItem(itemId, optionId) –ø—Ä–æ–≤–µ—Ä–∏—Ç —É—Å–ª–æ–≤–∏—è (–Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å), —Å–ø–∏—à–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–º–æ–∂–Ω–æ —Ç–æ–∂–µ —á–µ—Ä–µ–∑ inventoryStore ‚Äì —É–¥–∞–ª–µ–Ω–∏–µ —Ä—É–Ω—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä), –æ–±–Ω–æ–≤–∏—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞. –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ inventoryStore.items, —á—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å).

–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ ‚Äì —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–µ–∫–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –ó–Ω–∞—á–∏—Ç, —É –Ω–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å playerStatsStore —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–ª–∞, –ª–æ–≤–∫–æ—Å—Ç—å –∏ —Ç.–¥.). –ü—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ –≤—ã–∑—ã–≤–∞–µ–º playerStatsStore.train('strength'), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—Ä–µ–±—É–µ—Ç 1 –æ—á–∫–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ 100 –∑–æ–ª–æ—Ç–∞) –∏ –ø–æ–≤—ã—Å–∏—Ç strength. –ï—Å–ª–∏ —ç—Ç–æ –≤—Ä–µ–º—è-–∑–∞—Ç—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å N —á–∞—Å–æ–≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏), –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—Å–ª–æ–∂–Ω–µ–µ, –≤—ã–π–¥–µ—Ç –∑–∞ —Ä–∞–º–∫–∏ –±–∞–∑–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã). –ü–æ–∫–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ TrainingModal –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (¬´+1 –∫ —Å–∏–ª–µ!¬ª) –∏ –∑–∞–∫—Ä—ã—Ç—å—Å—è.

–î–∏–∞–ª–æ–≥: –û–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ViewModel –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª—ã, —á—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–∞—Ä—Ç—ã (—Å–º. –≤—ã—à–µ).

4.7. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É —Å–æ–±–æ–π: –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—á–∫–∞ –∫—É–∑–Ω–µ—Ü–∞ –º–æ–∂–µ—Ç —Å–æ–≤–º–µ—â–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é –∏ —É–ª—É—á—à–µ–Ω–∏–µ (–ø—Ä–æ–¥–∞—ë—Ç –∏ —É–ª—É—á—à–∞–µ—Ç). –í –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —ç—Ç–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

–õ–∏–±–æ –∫–∞–∫ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–æ —Ç–æ–≥–¥–∞ –¥–≤–∞ –∫–ª–∏–∫–∞ —Ä–∞–∑–Ω—ã—Ö ‚Äì –Ω–µ—É–¥–æ–±–Ω–æ).

–õ–∏–±–æ –∫–∞–∫ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –≤–∫–ª–∞–¥–∫–∏ ¬´–¢–æ—Ä–≥–æ–≤–ª—è¬ª –∏ ¬´–£–ª—É—á—à–µ–Ω–∏–µ¬ª. –¢–æ –µ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª TradeWindow –∏ UpgradeStation. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª–∏–±–æ —Å–ø–µ—Ü–ª–æ–≥–∏–∫–æ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ NPC, –ª–∏–±–æ –±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ ‚Äì –ø–æ–∑–≤–æ–ª–∏—Ç—å –æ–¥–Ω–æ–º—É MapPointInteraction –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±: type: 'trade&upgrade' –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∏ —Ç–æ –∏ –¥—Ä—É–≥–æ–µ. –ù–æ –ø—Ä–æ—â–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ: –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ point.npcId === 'smith', –ø–æ–∫–∞–∑–∞—Ç—å –æ–±–µ –≤–∫–ª–∞–¥–∫–∏. –í –Ω–∞—à–µ–º –æ–ø–∏—Å–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∫—É–∑–Ω–µ—Ü –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±–µ —É—Å–ª—É–≥–∏:

{ id: 'blacksmith', type: 'trade', title: '–ö—É–∑–Ω–µ—Ü', data: { npcId: 'smith', inventory: [...], upgradeOptions: [...] } }


–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç TradeWindow —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ data.upgradeOptions –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äì –≤–∫–ª—é—á–∏—Ç—å –≤–∫–ª–∞–¥–∫—É ¬´–£–ª—É—á—à–µ–Ω–∏–µ¬ª. –≠—Ç–æ –±–æ–ª—å—à–µ –ª–æ–≥–∏–∫–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ UI.

–î–ª—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏, –º–æ–∂–Ω–æ –ø–æ–π—Ç–∏ –¥—Ä—É–≥–∏–º –ø—É—Ç—ë–º: –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, MapPointModal –º–æ–≥ –±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–µ –æ–¥–∏–Ω, –∞ –º–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤, –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—Ü–∏–π. –ù–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å. –í–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ—à–∞—Ç—å —É—Å–ª–æ–≤–Ω–æ.

4.8. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞ (–±—É–¥—å —Ç–æ —Ç–æ—Ä–≥–æ–≤–ª—è, —É–ª—É—á—à–µ–Ω–∏–µ –∏–ª–∏ –¥—Ä.) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç—É. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ç–∞–∫ —á—Ç–æ –∏–≥—Ä–æ–∫, –æ—Ç–∫—Ä—ã–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–ª–∏ —Å—Ç–∞—Ç—É—Å, —É–≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç X¬ª ‚Äì –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ TradeWindow).

4.9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ç–æ—á–µ–∫:

–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (—Ç–æ–≤–∞—Ä—ã, –Ω–∞–≤—ã–∫–∏ –∏ —Ç.–ø.).

–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: –∫—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç (–∑–æ–ª–æ—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è, –ø—Ä–µ–¥–º–µ—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è), —É–ª—É—á—à–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–µ–Ω—è—é—Ç—Å—è, —Ä–µ—Å—É—Ä—Å—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è), –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è (–Ω–∞–≤—ã–∫ +1, –∑–æ–ª–æ—Ç–æ —Å–ø–∏—Å–∞–Ω–æ).

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏: –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥/—Ä–µ—Å—É—Ä—Å–æ–≤ ‚Äì –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –æ—Ç–∫–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ).

–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π ‚Äì —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–Ω–∏–∫–∞–∫–∏—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤).

–ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ: –Ω–µ—Ç —É—Ç–µ—á–µ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ —Ç–æ–≤–∞—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏).

–ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏–∞–ª–æ–≥–æ–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏: –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–∏–∞–ª–æ–≥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è VN —Å—Ü–µ–Ω–∞, –∏ –ø–æ—Å–ª–µ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, onFinish –º–æ–¥–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥).

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –æ–ø–∏—Å–∞–Ω–Ω–∞—è –≤—ã—à–µ, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –∫–∞—Ä—Ç–∞ –ª–∏—à—å –∑–Ω–∞–µ—Ç, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å, –∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–Ω–∞—é—Ç, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–æ—Ä–≥–æ–≤–ª–µ–π/—É–ª—É—á—à–µ–Ω–∏–µ–º. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ (—Å–∫–∞–∂–µ–º, ¬´–∞–ª—Ç–∞—Ä—å¬ª –¥–ª—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤) —Å–≤–æ–¥–∏—Ç—Å—è –∫: –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π —Ç–∏–ø –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Å–æ–∑–¥–∞–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç AltarModal, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –ª–æ–≥–∏–∫—É (–Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —Å—Ö–æ–∂—É—é —Å —É–ª—É—á—à–µ–Ω–∏–µ–º), –∏ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ –µ–≥–æ –≤ MapPointModal. –ú–∏–Ω–∏–º—É–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.

5. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–µ–ª–ª –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ù–∞–∫–æ–Ω–µ—Ü, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ–±—â–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã VN –∏ —Å—Ä–∞–≤–Ω–∏–º, –∫–∞–∫ –∏—Ö –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

5.1 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏–∫–∏ (—Å—Ü–µ–Ω–∞—Ä–∏–∏ vs –¥–≤–∏–∂–æ–∫)

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—Ä–æ–¥–µ Ren'Py, TyranoBuilder, VN Maker –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ —Å–¥–µ–ª–∞–Ω —à–∞–≥ –≤ —ç—Ç—É —Å—Ç–æ—Ä–æ–Ω—É:

–°—Ü–µ–Ω—ã –∏ —Ä–µ–ø–ª–∏–∫–∏ –æ–ø–∏—Å–∞–Ω—ã —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ (–≤ TS —Ñ–∞–π–ª–∞—Ö –≤ src/entities/visual-novel/model/scenes.ts), –≤–∫–ª—é—á–∞—è —Ç–µ–∫—Å—Ç—ã, –≤–∞—Ä–∏–∞–Ω—Ç—ã, –ø–µ—Ä–µ—Ö–æ–¥—ã, —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –ø—Ä. –î–≤–∏–∂–æ–∫ (useVisualNovelViewModel –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã) –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.

Best practice ‚Äì –¥–∞–ª–µ–µ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è. –í—Å–µ —Å—é–∂–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–∏–∞–ª–æ–≥–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–±–æ—Ä–æ–≤, —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤) –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç React (–≤ —Ñ–∞–π–ª–∞—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è), —á—Ç–æ–±—ã —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –∏–ª–∏ –≥–µ–π–º–¥–∏–∑–∞–π–Ω–µ—Ä –º–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞. –õ–æ–≥–∏–∫–∞ –¥–≤–∏–∂–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∏ –Ω–µ ¬´–∑–∞—à–∏—Ç–æ–π¬ª –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—é–∂–µ—Ç.

–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DSL (domain-specific language) –∏–ª–∏ —Ö–æ—Ç—è –±—ã —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è. Ren'Py, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–∫—Ä–∏–ø—Ç–æ–≤—ã–π —è–∑—ã–∫ (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ Python) —Å –º–µ—Ç–∫–∞–º–∏, –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ (jump label), —É—Å–ª–æ–≤–∏—è–º–∏ (if flag:) –∏ –ø—Ä. –í—ã –º–æ–≥–ª–∏ –±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ (—Ö–æ—Ç—è –¥–ª—è TypeScript –≥–æ—Ç–æ–≤—ã—Ö VN-–ø–∞—Ä—Å–µ—Ä–æ–≤ –º–∞–ª–æ). –ù–æ –¥–∞–∂–µ –±–µ–∑ —ç—Ç–æ–≥–æ, –≤–∞—à–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å JSON –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞. –ì–ª–∞–≤–Ω–æ–µ ‚Äì –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∏—Å—å: –ø–æ–∫–∞–∑—ã/—Å–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ–Ω–∞, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤, –ø–∞—É–∑—ã, —É—Å–ª–æ–≤–Ω—ã–µ –≤–µ—Ç–≤–ª–µ–Ω–∏—è (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–ª–∞–≥–æ–≤/–Ω–∞–≤—ã–∫–æ–≤) –∏ —Ç.–¥. –°—É–¥—è –ø–æ VisualNovelSceneDefinition, —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—è –¥–ª—è —Ñ–ª–∞–≥–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞–≤—ã–∫–æ–≤, –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏ ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–≤–∏–∂–æ–∫ –∏—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç. –ï—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤—ã–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —Ä–µ–ø–ª–∏–∫–∏), –¥–æ–±–∞–≤—å—Ç–µ –≤ ViewModel –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º currentLine (–≤ buildChoiceViews –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ª–∏–Ω–∏–∏).

5.2 –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞

–í–∞–∂–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω ‚Äì –º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–ª–∏ –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–∞–ª–æ–≥–∞. –í Ren'Py —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–¥—ë—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä—ã–≥–∞—Ç—å –ø–æ –º–µ—Ç–∫–∞–º. –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ useVisualNovelViewModel —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å—Ç–µ–π—Ç-–º–∞—à–∏–Ω—É:

–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–π —Å—Ü–µ–Ω–æ–π (scene) –∏ —Ç–µ–∫—É—â–µ–π —Ä–µ–ø–ª–∏–∫–æ–π (currentLine)
GitHub
.

–ü–µ—Ä–µ—Ö–æ–¥—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø–æ —Å–æ–±—ã—Ç–∏—è–º: –ª–∏–±–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–¥–∞–ª–µ–µ" (goNext)
GitHub
, –ª–∏–±–æ –≤—ã–±—Ä–∞–ª –≤–∞—Ä–∏–∞–Ω—Ç (choose)
GitHub
, –ª–∏–±–æ –ø—Ä–æ–∏–∑–æ—à—ë–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ nextSceneId
GitHub
.

–≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥. –û–Ω —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äì –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ü–µ–Ω—ã –∏ —Ä–µ–ø–ª–∏–∫–∏, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –≤–∫–ª—é—á–∏—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫–∞–∑–∞–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏ –∏ —Å—Ü–µ–Ω—ã, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–æ—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å scene.id –∏ line.id (–≤—ã –∏ —Ç–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ª–æ–≥–æ–≤
GitHub
GitHub
).

–ü–∞—Ç—Ç–µ—Ä–Ω "Label/Jump": –í Ren'Py —Å—Ü–µ–Ω–∞—Ä–∏–∏ –º–µ—Ç–∫–∏ (label) –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ª–∏–Ω–µ–π–Ω–æ, –Ω–æ –∏ –ø–æ –∏–º–µ–Ω–∞–º. –£ –≤–∞—Å –∞–Ω–∞–ª–æ–≥ ‚Äì nextLineId –∏ transition.nextSceneId. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ ‚Äì —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –º–æ–∂–µ—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ü–∏–∫–ª—ã (–≤–æ–∑–≤—Ä–∞—Ç –∫ —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º —Ä–µ–ø–ª–∏–∫–∞–º –ø–æ —É—Å–ª–æ–≤–∏—é) ‚Äì –µ—Å–ª–∏ —Ç–∞–∫–æ–µ –Ω—É–∂–Ω–æ.

–£—Å–ª–æ–≤–∏—è –∏ –≤–µ—Ç–≤–ª–µ–Ω–∏–µ: –ß–∞—Å—Ç–æ VN —Ç—Ä–µ–±—É—é—Ç —É—Å–ª–æ–≤–∏—è: –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–ø–ª–∏–∫—É –∏–ª–∏ –≤—ã–±–æ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ –∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ >= X. –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ buildChoiceViews ‚Äì —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å VisualNovelChoice –ø–æ —É—Å–ª–æ–≤–∏—è–º (–º–æ–∂–µ—Ç, —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–µ disabled –∏ lockReason ‚Äì —Å—É–¥—è –ø–æ choiceViews.some(choice => !choice.disabled)
GitHub
, –≤—ã —É–∂–µ –ø–æ–º–µ—á–∞–µ—Ç–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã). Best practice: —É—Å–ª–æ–≤–∏—è –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, choice.requiredFlag –∏–ª–∏ line.condition = { flag: 'x', value: true }). –î–≤–∏–∂–æ–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ —É—Å–ª–æ–≤–∏—è –ø—Ä–∏ –≤—ã–≤–æ–¥–µ. –≠—Ç–æ —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Choice.disabled —É –≤–∞—Å –æ—Ç–∫—É–¥–∞-—Ç–æ –±–µ—Ä—ë—Ç—Å—è, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ buildChoiceViews –Ω–∞ –æ—Å–Ω–æ–≤–µ flags). –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å: –Ω–∞–ø—Ä., –ø–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ ‚Äì –≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è. –í–∞—à –¥–≤–∏–∂–æ–∫ –º–æ–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å —ç—Ç–æ–º—É: —Ö—Ä–∞–Ω–∏—Ç—å –≤ VisualNovelSessionStore –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–≤—ã–∫–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –≤—ã–±–æ—Ä–æ–≤.

5.3 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è VN ‚Äì –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –Ω–æ–≤–µ–ª–ª–∞ –¥–æ–ª–≥–∞—è. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ VN-–¥–≤–∏–∂–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–ª–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π, –∞–≤—Ç–æ—Å–µ–π–≤. –£ –≤–∞—Å —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å—Ü–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ commitScene –≤ flushSession) –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ü–µ–Ω—ã
GitHub
. –û–¥–Ω–∞–∫–æ, —ç—Ç–æ –ø–æ—Ö–æ–∂–µ —Å–∫–æ—Ä–µ–µ –Ω–∞ –æ—Ç—á—ë—Ç –æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏, —á–µ–º –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏. –í–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∫–æ–Ω—Ü–∞ —Å—Ü–µ–Ω—ã:

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ü–µ–Ω—ã –∏ —Ä–µ–ø–ª–∏–∫–∏, –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö. –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ: scene.id, currentLine.id, –Ω–∞–±–æ—Ä —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ (–∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–π/—Å—Ç–∞—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –¥–∞–ª—å–Ω–µ–π—à–∏–π —Ö–æ–¥ —Å—é–∂–µ—Ç–∞).

–í—ã –º–æ–∂–µ—Ç–µ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤ JSON –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏–±–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞), –ª–∏–±–æ –≤ localStorage (–µ—Å–ª–∏ –æ–¥–Ω–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞). –†–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω (–µ—Å—Ç—å deviceId –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–µ—Ä–≤–µ—Ä—É), –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äì —Ç–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ —Å–º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ saveGame(slot) –∏ loadGame(slot). –§—É–Ω–∫—Ü–∏—è saveGame –±–µ—Ä—ë—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ useVisualNovelViewModel –∏ useVisualNovelSessionStore. –ù–∞–ø—Ä–∏–º–µ—Ä:

function saveGame(slotName: string) {
   const state = {
      sceneId: viewModel.scene.id,
      lineId: viewModel.currentLine?.id,
      flags: Array.from(viewModel.flags),
      // –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é (history) –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ª–∏—Å—Ç–∞—Ç—å –∂—É—Ä–Ω–∞–ª –¥–∏–∞–ª–æ–≥–∞, —Ö–æ—Ç—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
      stats: playerStatsStore.getState(), // –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—Å—ã
      inventory: inventoryStore.getState(), // –∏ —Ç.–¥.
   }
   localStorage.setItem(`save_${slotName}`, JSON.stringify(state))
}


–§—É–Ω–∫—Ü–∏—è loadGame —á–∏—Ç–∞–µ—Ç JSON, –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

function loadGame(slotName: string) {
   const stateStr = localStorage.getItem(`save_${slotName}`)
   if (!stateStr) return false
   const state = JSON.parse(stateStr)
   useVisualNovelSessionStore.getState().startSession(state.sceneId)    // –Ω–∞—á–∞—Ç—å —Å –Ω—É–∂–Ω–æ–π —Å—Ü–µ–Ω—ã
   const vm = useVisualNovelViewModel({ sceneId: state.sceneId })      // –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π viewModel
   vm.flags = new Set(state.flags)                                     // —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥–∏
   // –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—å—Å—è –ø–æ —Å—Ü–µ–Ω–µ –¥–æ –Ω—É–∂–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏:
   if (state.lineId && vm.currentLine?.id !== state.lineId) {
       vm.jumpToScene(state.sceneId)        // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ü–µ–Ω—É
       vm.goNext()                          // –∏–ª–∏ –ª—É—á—à–µ, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å jumpToLine
       // –≤–∞—Ä–∏–∞–Ω—Ç: –≤—ã–∑–≤–∞—Ç—å advanceToLine(state.lineId) –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –æ–Ω –≤–Ω—É—Ç—Ä–∏ —Ö—É–∫–∞
   }
   // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–æ—Ä—ã:
   playerStatsStore.setState(state.stats)
   inventoryStore.setState(state.inventory)
   return true
}


–ó–¥–µ—Å—å –µ—Å—Ç—å –Ω—é–∞–Ω—Å: –≤–∞—à useVisualNovelViewModel ‚Äì —ç—Ç–æ React-—Ö—É–∫, –µ–≥–æ –Ω–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ù–æ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ VisualNovelExperience –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ñ—Ñ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª–µ–¥–∏—Ç –∑–∞ –Ω–µ–∫–∏–º —Ñ–ª–∞–≥–æ–º –∑–∞–≥—Ä—É–∑–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å –Ω—É–∂–Ω—ã–π sceneId –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ lineId –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä lockedSceneId (–∏–ª–∏ –∑–∞–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –ø—Ä–æ–ø, —Å–∫–∞–∂–µ–º, startLineId). –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —É–ª—É—á—à–∏—Ç—å useVisualNovelViewModel ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ jumpToLine(lineId) –≤–Ω—É—Ç—Ä–∏ —Ö—É–∫–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ jumpToScene). –¢–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –±—É–¥–µ—Ç: startSession(sceneId) –¥–ª—è SessionStore (–æ–±–Ω—É–ª–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é), –ø–æ—Ç–æ–º –≤—ã–∑–≤–∞—Ç—å viewModel.jumpToScene(sceneId), –∞ –∫–æ–≥–¥–∞ ViewModel –≤–æ—Å—Å–æ–∑–¥–∞—Å—Ç—Å—è ‚Äì —Å—Ä–∞–∑—É –≤—ã–∑–≤–∞—Ç—å jumpToLine(lineId) —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏. –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–±–æ–ª—å—à–æ–≥–æ —Ç–∞–π–º–∞—É—Ç–∞ –∏–ª–∏ useEffect, —Ç.–∫. jumpToScene –∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ startTransition.

–í –æ–±—â–µ–º, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Å—Ü–µ–Ω—ã —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã —Å –Ω–∞—á–∞–ª–∞. –ù–æ —Ä–∞–∑ —É –≤–∞—Å –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID —É –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏ (—Å—É–¥—è –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º prologue_train_stop__line0), —Ç–æ –≤–ø–æ–ª–Ω–µ —Ä–µ–∞–ª—å–Ω–æ.

–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–ª–∏ –∫–∞–∂–¥–æ–π —Å—Ü–µ–Ω—ã. –£ –≤–∞—Å –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Å—Ü–µ–Ω—ã —É–∂–µ –æ—Ç—Å—ã–ª–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å: –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–∏–º–æ–≥–æ —à–∞–≥–∞ (—Ä–µ–ø–ª–∏–∫–∏ –∏–ª–∏ –≤—ã–±–æ—Ä–∞) –æ–±–Ω–æ–≤–ª—è—Ç—å autosave (–≤ localStorage) ‚Äì —Ç–æ–≥–¥–∞ –¥–∞–∂–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è. –û–¥–Ω–∞–∫–æ, –Ω–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ —á–∞—Å—Ç—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å autosave –ª–æ–∫–∞–ª—å–Ω–æ, –∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π commit (–∫–∞–∫ —Å–µ–π—á–∞—Å).

–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–µ–ø–ª–∏–∫–∏: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ —ç—Ñ—Ñ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–±–æ—Ä –≤—ã–¥–∞–ª –µ–º—É –º–µ—á, –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É –Ω–µ–≥–æ –º–µ—á —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏ –≤—ã–±–æ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–Ω–æ–≤–∞ –µ–≥–æ –≤—ã–¥–∞–≤–∞—Ç—å. –í –≤–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ (–≤ history –∏ SessionStore –∑–∞–ø–∏—Å–∞–Ω–æ). –ï—Å–ª–∏ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞, —Ç–æ –≤ SessionStore pendingAddFlags, pendingItems —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ó–∞–≥—Ä—É–∂–∞—è, –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ç–∞–∫ —á—Ç–æ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Å–ª—É—á–∏—Ç—Å—è. –ù–æ –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–µ–ª–∞–µ—Ç—Å—è –¥–æ commit, SessionStore –≤—Å–µ –µ—â–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç–∏ pending –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–∏—Ç –æ—á–∏—Å—Ç–∏—Ç—å SessionStore –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å, —á—Ç–æ —á–∞—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —É–∂–µ —É—á—Ç–µ–Ω–∞. –õ–∏–±–æ –ø—Ä–æ—â–µ: —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏ –∏–ª–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö. –ú–Ω–æ–≥–∏–µ VN –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤–Ω–µ –¥–∏–∞–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ç–µ–∫—Å—Ç–∞), —Ç–∞–∫ —á—Ç–æ –ª—É—á—à–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∏ mid-—Å—Ü–µ–Ω—ã.

5.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤

–ï—Å–ª–∏ –≤–∞—à–∞ –Ω–æ–≤–µ–ª–ª–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è (–º–Ω–æ–≥–æ –≥–ª–∞–≤, —Ç—ã—Å—è—á–∏ —Ä–µ–ø–ª–∏–∫), –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –æ—Ç–∑—ã–≤—á–∏–≤—ã–º. –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤:

–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ü–µ–Ω: –Ω–µ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å—Ä–∞–∑—É –≤ –ø–∞–º—è—Ç—å, –µ—Å–ª–∏ –∏—Ö –æ—á–µ–Ω—å –º–Ω–æ–≥–æ. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞–∑–±–∏—Ç—å VISUAL_NOVEL_SCENES –Ω–∞ —á–∞–Ω–∫–∏/–º–æ–¥—É–ª–∏ –∏ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –≥–ª–∞–≤—ã 2+ –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (—á–µ—Ä–µ–∑ import()), –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è. –£ –≤–∞—Å getVisualNovelScene(id) –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ‚Äì —ç—Ç–æ –æ–∫, –ø–æ–∫–∞ –≤—Å–µ –≤ –±–∞–Ω–¥–ª–µ. –ï—Å–ª–∏ –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ lazy. TyranoBuilder –∏ VN Maker –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é –≥–ª–∞–≤—É, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç –∏–∑ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏/—Å–æ—Å—Ç–æ—è–Ω–∏–π: –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Ö—Ä–∞–Ω–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –í—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç–µ –∏—Å—Ç–æ—Ä–∏—é (history) –≤—Å–µ—Ö –ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫
GitHub
GitHub
. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ –∂—É—Ä–Ω–∞–ª–∞ –¥–∏–∞–ª–æ–≥–∞ (¬´History/Backlog¬ª —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–ª–∏—Å—Ç–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ—Ä–∞–∑—ã). –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫–∞—è —Ñ–∏—á–∞, —Ö—Ä–∞–Ω–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Ä–µ–ø–ª–∏–∫) —á—Ç–æ–±—ã –ø–∞–º—è—Ç—å –Ω–µ —Ä–æ—Å–ª–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ. –ï—Å–ª–∏ —Ñ–∏—á–∞ –Ω–µ –Ω—É–∂–Ω–∞ ‚Äì –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –æ—á–∏—â–∞—Ç—å history –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É.

–ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ä–µ–Ω–¥–µ—Ä–æ–≤: –í React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ª–∏—à–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã ‚Äì –≥–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è props. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç CharacterGroup (–∞–≤–∞—Ç–∞—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π) –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è activeCharacterId –∏–ª–∏ —ç–º–æ—Ü–∏–∏, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ –∫–∞–∂–¥—É—é –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—É ‚Äì –µ–≥–æ –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ React.memo, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–ª—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –≤–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞ —Ç–µ–∫—Å—Ç–∞. –í –≤–∞—à–µ–º —á–µ–∫-–ª–∏—Å—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å –º–µ–º–æ–∏–∑–∞—Ü–∏—è ChoicePanel –∏ CharacterGroup
GitHub
GitHub
 ‚Äì —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –¢–∞–∫–∂–µ, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ React 19.2 –≤–≤–æ–¥–∏—Ç Activity API (Offscreen), —É–ø–æ–º—è–Ω—É—Ç–∞—è –≤ –≤–∞—à–µ–º –¥–æ–∫—Å—Ç–µ
GitHub
GitHub
. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å/–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í—ã —É–∂–µ –Ω–∞–º–µ—Ä–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –¥–ª—è –ø–∞–Ω–µ–ª–∏ –≤—ã–±–æ—Ä–æ–≤, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã–±–æ—Ä—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏–ª–∏ –∏—Å—á–µ–∑–∞—é—Ç. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç –º–∏–≥–∞–Ω–∏–µ UI –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –æ—Ç —á–∞—Å—Ç—ã—Ö –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–π. –°–ª–µ–¥—É–π—Ç–µ —ç—Ç–æ–º—É –ø–ª–∞–Ω—É ‚Äì –æ–±–µ—Ä–Ω—É—Ç—å <ChoicePanel> –≤ <Activity mode={hasChoices ? 'visible' : 'hidden'}>
GitHub
, –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É React –±—É–¥–µ—Ç ¬´–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å¬ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∞ –Ω–µ —É–±–∏–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤—ã–±–æ—Ä–∞.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Concurrent Mode: React 18+ Concurrent features (–∫–∞–∫ useTransition –≤—ã —É–∂–µ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏) –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–≥–∞—Ç—å —Ñ—Ä–∏–∑–æ–≤ UI –ø—Ä–∏ —Ç—è–∂—ë–ª—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö. –í—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–º–µ—Ç–∏–ª–∏ —Å–º–µ–Ω—É —Å—Ü–µ–Ω—ã –∫–∞–∫ –ø–µ—Ä–µ—Ö–æ–¥ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
GitHub
. –ú–æ–∂–Ω–æ –µ—â–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å React 18 Suspense –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å—Ü–µ–Ω—ã ‚Äì –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äì —Å Suspense). –í –±—É–¥—É—â–µ–º, React –ø–æ–∑–≤–æ–ª–∏—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å–∫—Ä–∏–Ω —Å –¥–∏–∞–ª–æ–≥–æ–º —Ñ–æ–Ω–æ–º –∑–∞–±–ª–∞–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞) –∏ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è ‚Äì –Ω–æ —ç—Ç–æ —É–∂–µ —ç–∫–∑–æ—Ç–∏–∫–∞. –í —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∞–ª–∏—è—Ö —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞, –≤—ã–±–æ—Ä) –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å DOM: –ú—ã —É–∂–µ —É–ø–æ–º—è–Ω—É–ª–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ re-render –Ω–∞ –ø–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞. –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –±–æ–ª—å—à–∏–µ —Å–ø–∏—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ –≤—ã–±–æ—Ä–æ–≤, –µ—Å–ª–∏ –∏—Ö –≤–¥—Ä—É–≥ –º–Ω–æ–≥–æ) —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. –û–±—ã—á–Ω–æ –≤—ã–±–æ—Ä–æ–≤ –Ω–µ–º–Ω–æ–≥–æ, —Ç–∞–∫ —á—Ç–æ –æ–∫. –ï—Å–ª–∏ —Å–¥–µ–ª–∞–µ—Ç–µ, —Å–∫–∞–∂–µ–º, –ª–∏—Å—Ç–∞–ª–∫—É –∂—É—Ä–Ω–∞–ª–∞ –¥–∏–∞–ª–æ–≥–∞, –ª—É—á—à–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å react-window –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–µ), —á—Ç–æ–±—ã –Ω–µ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ —Å—Ç—Ä–æ–∫ —Å—Ä–∞–∑—É.

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π: –§—É–Ω–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ buildChoiceViews(currentLine, flags)
GitHub
 ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ useMemo –∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –Ω—É–∂–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤—ã —Ç–∞–∫ –∏ —Å–¥–µ–ª–∞–ª–∏, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç currentLine –∏ flags). –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç –≤—ã–±–æ—Ä–æ–≤ –±–µ–∑ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏.

–†–∞–±–æ—Ç–∞ —Å –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞: –ï—Å–ª–∏ —É –≤–∞—Å –±—É–¥—É—Ç —Ñ–æ–Ω—ã, —Å–ø—Ä–∞–π—Ç—ã, –º—É–∑—ã–∫–∞ ‚Äì –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Ö —Ç–æ–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–µ—Ä—Ñ–æ–º–∞–Ω—Å. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω—ã –≤–æ –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤). Ren'Py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É—Ñ–µ—Ä–∏–∑—É–µ—Ç –æ–±—Ä–∞–∑—ã. –í –≤–µ–±–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Image() –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–æ–Ω–∞ –∏–ª–∏ —Å–ø—Ä–∞–π—Ç–∞, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Ç–µ–∫—Å—Ç. –ï—Å–ª–∏ —Å—Ü–µ–Ω—ã –∏–¥—É—Ç –ª–∏–Ω–µ–π–Ω–æ, –º–æ–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è. –ï—Å–ª–∏ –Ω–µ–ª–∏–Ω–µ–π–Ω–æ ‚Äì –º–æ–∂–Ω–æ –ø–æ nextSceneId –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å.

Massive branching handling: –í –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –¥–µ—Ä–µ–≤–∞—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–µ—Ç–æ–∫, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–π–¥–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ. –•—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–º—è—Ç–∏ –≤–µ—Å—å —Ä–∞–∑–≤–µ—Ç–≤–ª—ë–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ (—Ç–µ–∫—Å—Ç ‚Äì –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏). –ù–æ –µ—Å–ª–∏ –µ—Å—Ç—å –æ—á–µ–Ω—å –≥–ª—É–±–æ–∫–∏–µ –≤–µ—Ç–∫–∏, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ–∫—É—Ä—Å–∏—è –∏–ª–∏ —Ü–∏–∫–ª –≤ –ª–æ–≥–∏–∫–µ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é. –í–∞—à –∞–ª–≥–æ—Ä–∏—Ç–º advanceToLine –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏–±–æ –∫ –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–µ, –ª–∏–±–æ –∫ —Å–ª–µ–¥—É—é—â–µ–π, –ª–∏–±–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å—Ü–µ–Ω—É
GitHub
GitHub
 ‚Äì –æ–Ω –Ω–µ —Ä–µ–∫—É—Ä—Å–∏–≤–µ–Ω, —Ç–∞–∫ —á—Ç–æ —Å—Ç–µ–∫ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ.

5.5 –°–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞

–ï—â—ë –æ–¥–Ω–∞ —Ñ–∏—á–∞ VN ‚Äì –±—ã—Å—Ç—Ä—ã–π –≤–æ–∑–≤—Ä–∞—Ç/–ø—Ä–æ–ø—É—Å–∫. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ª—é–±—è—Ç —Å–∫–∏–ø–∞—Ç—å —É–∂–µ –≤–∏–¥–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

–§—É–Ω–∫—Ü–∏—é ¬´–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª ‚Äì –∫–æ—Ç–æ—Ä–∞—è –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ü–µ–Ω—ã. –í –≤–∞—à–µ–º –¥–≤–∏–∂–∫–µ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ –∏ —Ç–æ–≥–¥–∞ –ª–∏–±–æ —É—Å–∫–æ—Ä–∏—Ç—å –ø–µ—á–∞—Ç—å (0 –∑–∞–¥–µ—Ä–∂–∫–∏) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∂–∞—Ç—å goNext –ø–æ–∫–∞ –Ω–µ –¥–æ–π–¥–µ—Ç–µ –¥–æ —Å—Ç–æ–ø-—Å–æ–±—ã—Ç–∏—è (–≤—ã–±–æ—Ä –∏–ª–∏ –∫–æ–Ω–µ—Ü). –ù–æ –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã, —á—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. Ren'Py, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–∫–∏–ø–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Ç–∫–∏, –ø—Ä–æ—Å—Ç–æ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—ã–≤–æ–¥–µ. –í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –µ—Å–ª–∏ —É –≤–∞—Å –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –æ—Ç UI, –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å: –ø–æ–∫–∞ skipMode true, —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ currentLine –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∫–ª–∏–∫–∞/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–∞. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ª–æ–º–∞—Ç—å —Ü–∏–∫–ª –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äì –º–æ–∂–µ—Ç, –ø—Ä–æ—â–µ: –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω skip, —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞—Ç—å onAdvance() –ø—Ä–∏ onRevealComplete –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏.

–§—É–Ω–∫—Ü–∏—è ¬´–õ–æ–≥¬ª (–∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞) ‚Äì –µ—Å–ª–∏ –æ–Ω–∞ –Ω—É–∂–Ω–∞, —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ–ø–ª–∏–∫ (–≤—ã —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç–µ history). –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ –Ω–∞–∂–∞—Ç–∏—é ¬´–ò—Å—Ç–æ—Ä–∏—è¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ history —Å –∏–º–µ–Ω–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ —Ç–µ–∫—Å—Ç–æ–º. –≠—Ç–æ —á–∏—Å—Ç–æ UI –∑–∞–¥–∞—á–∞, –Ω–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ history —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –í–∞—à recordHistory –ø–∏—à–µ—Ç –∫–∞–∂–¥—É—é –ø—Ä–æ–π–¥–µ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫—É —Å timestamp
GitHub
 ‚Äì –º–æ–∂–Ω–æ –æ–±–æ–≥–∞—Ç–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–µ–∫—Å—Ç. –°–µ–π—á–∞—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ sceneId –∏ lineId
GitHub
. –î–ª—è –≤—ã–≤–æ–¥–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏–¥—ë—Ç—Å—è –º–∞–ø–∏—Ç—å —ç—Ç–∏ id –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ç–µ–∫—Å—Ç (–ø–æ VISUAL_NOVEL_SCENES). –õ—É—á—à–µ —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç: —Ç–æ–≥–¥–∞ history —Å—Ç–∞–Ω–µ—Ç –º–∞—Å—Å–∏–≤–æ–º {sceneId, lineId, speaker, text, choiceId?, timestamp}. –ó–∞–ø–æ–ª–Ω—è—Ç—å –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Ä–µ–ø–ª–∏–∫–∏ (–≤—ã —ç—Ç–æ –¥–µ–ª–∞–µ—Ç–µ –≤ recordHistory). –¢–æ–≥–¥–∞ –∂—É—Ä–Ω–∞–ª –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∞–∂–µ –¥–ª—è –ø—Ä–æ—à–ª—ã—Ö —Å—Ü–µ–Ω, –µ—Å–ª–∏ –Ω–µ –æ—á–∏—Å—Ç–∏–ª–∏ history.

–û—Ç–∫–∞—Ç (rollback): Ren'Py –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–∏—Å—Ç–∞—Ç—å –∫–æ–ª–µ—Å–æ–º –≤–≤–µ—Ä—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø—Ä–æ—à–ª—ã–º —Ä–µ–ø–ª–∏–∫–∞–º, –Ω–æ —ç—Ç–æ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–µ–±—É—é—â–∞—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –Ω–∞ –∫–∞–∂–¥—ã–π —à–∞–≥. –í –±—Ä–∞—É–∑–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è history stack, –Ω–æ —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —Ñ–ª–∞–≥–æ–≤ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–π ‚Äì –¥–æ—Ä–æ–≥–æ. –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ —Å—Ç–æ–∏—Ç —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å (–º–∞–ª–æ –∫—Ç–æ –æ–∂–∏–¥–∞–µ—Ç —Ç–∞–∫–æ–≥–æ –≤–Ω–µ Ren'Py).

5.6 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

–ü—Ä–∏–º–µ–Ω—è—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —É–¥–µ–ª—è–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–µ. –õ–æ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –≤—Å—Ç–∞–≤–∏–ª–∏ (console.log —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏) ‚Äì –æ—Ç–ª–∏—á–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏—Ö (–º–æ–∂–µ—Ç, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–∫–ª—é—á–∞–µ–º–æ —Ñ–ª–∞–≥–æ–º debug). –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —É—à–ª–∏:

–î–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä ‚Äì –º—ã —É–∂–µ –∑–Ω–∞–µ–º –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: –ª–æ–≥–∏ DialogueBox –Ω–µ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –ø–∞—Ä–∞–º–∏ –Ω–∞ –æ–¥–Ω—É —Ä–µ–ø–ª–∏–∫—É.

–≠—Ñ—Ñ–µ–∫—Ç—ã ‚Äì –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ—Ç—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–æ—Ä —Å add_item –¥–æ–ª–∂–µ–Ω –ø–æ—Å–ª–µ —Å—Ü–µ–Ω—ã –æ—Ç—Ä–∞–∑–∏—Ç—å—Å—è –≤ payload (–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ Network, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è items: [...]).

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FSD (Feature-Sliced Design) ‚Äì –≤—ã —É–ø–æ–º—è–Ω—É–ª–∏ FSD, –≤–µ—Ä–æ—è—Ç–Ω–æ —É–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç–µ –ø–æ —Ñ–∏—á–∞–º. –°–æ–±–ª—é–¥–∞–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã: –æ—Ç–¥–µ–ª—è–π—Ç–µ entities, features, widgets, pages –∫–∞–∫ —É –≤–∞—Å –∏ —Å–¥–µ–ª–∞–Ω–æ. –ù–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–ø–∏—Å—ã–≤–∞—é—Ç—Å—è: —ç—Ñ—Ñ–µ–∫—Ç –≤—ã–±–æ—Ä–∞ ‚Äì —ç—Ç–æ –ª–æ–≥–∏–∫–∞ domain —É—Ä–æ–≤–Ω—è (entities), –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –µ—ë –≤ entities/choice –∏–ª–∏ –≤ features/visual-novel. MapPoint interactions ‚Äì —ç—Ç–æ –≤–ø–æ–ª–Ω–µ —É—Ä–æ–≤–µ–Ω—å features –∏–ª–∏ widgets (–µ—Å–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö). –í–∞–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–Ω–æ—Å–∏—Ç–µ –≥—Ä–æ–º–æ–∑–¥–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–∏–ø–∞ applyEffects) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞–∑–¥—É–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Ö—É–∫ ViewModel.

5.7 –°—É–º–º–∏—Ä—É—è best practices:

–î–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ, –ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ: —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ –¥–∞–Ω–Ω—ã—Ö, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –∏—Ö. –í–∞—à –ø—Ä–æ–µ–∫—Ç —É–∂–µ —Å–ª–µ–¥—É–µ—Ç —ç—Ç–æ–º—É, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π, –∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

–ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö: —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–ª–∞–≥ isLineRevealed –≤ VNScreen), –∞ –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ—Ä–∂–∞—Ç—å –≤ –≤–Ω–µ—à–Ω–∏—Ö —Å—Ç–æ—Ä–∞—Ö (Zustand) –∏–ª–∏ –≤ ViewModel. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫—É. –£ –≤–∞—Å —Ç–∞–∫ –∏ —Å–¥–µ–ª–∞–Ω–æ: SessionStore –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä—ã, ViewModel –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è VN, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Äì stateless UI –ø–æ —Å—É—Ç–∏. –≠—Ç–æ –±–ª–∏–∑–∫–æ –∫ –ø–∞—Ç—Ç–µ—Ä–Ω—É MVC: —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äì –º–æ–¥–µ–ª—å, ViewModel ‚Äì –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Äì view.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ React/Next.js —Ñ–∏—á–∏ (Suspense, Offscreen API, –º–µ–º–æ–∏–∑–∞—Ü–∏—è) –º–æ–≥—É—Ç —Å–∏–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å UX. –í—ã —É–∂–µ –≤–∫–ª—é—á–∏–ª–∏ –Ω–æ–≤—ã–µ API (React 19.2 Activity)
GitHub
 ‚Äì —ç—Ç–æ –æ—á–µ–Ω—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è React ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, Transition Tracing, —á—Ç–æ–±—ã –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å –¥–æ–ª–≥–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã, –∏–ª–∏ React Profiler –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç.

–£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –ø–æ–¥—É–º–∞–π—Ç–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Å—Ç—ã—Ö —É—Ç–∏–ª–∏—Ç –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç–æ–≤. –í–æ–∑–º–æ–∂–Ω–æ, —Å–¥–µ–ª–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è (—Å–∫—Ä–∏–ø—Ç, –ø—Ä–æ–±–µ–≥–∞—é—â–∏–π –ø–æ JSON –∏ –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π, —á—Ç–æ –≤—Å–µ nextLineId –∏ nextSceneId –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, —á—Ç–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ undefined –≤ —Ç–µ–∫—Å—Ç–µ). –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –æ—à–∏–±–∫–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞: –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å —Å–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π (—Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤—ã–±—Ä–∞–ª–æ —Ç—É –∏–ª–∏ –∏–Ω—É—é —Ä–∞–∑–≤–∏–ª–∫—É) ‚Äì –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∏–≥—Ä—ã. –í–∞—à SessionStore —É–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—ã–±–æ—Ä—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä ‚Äì —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –æ–Ω–∞ —Ü–µ–Ω–Ω–∞ –¥–ª—è –≥–µ–π–º–¥–∏–∑–∞–π–Ω–∞.

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏. –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Ç–∏–ø–∞ applyEffects (–ø–æ–¥–∞—ë–º –Ω–∞–±–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ ‚Äì –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–æ—Ä—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –æ–∂–∏–¥–∞–µ–º–æ). –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Jest + React Testing Library: –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–Ω—Ç–∏—Ä—É–µ–º DialogueBox —Å –¥–ª–∏–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º ‚Äì —Å–∏–º—É–ª–∏—Ä—É–µ–º –±—ã—Å—Ç—Ä—É—é —Å–º–µ–Ω—É props ‚Äì —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –º–∏–≥–∞–µ—Ç. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–∑–∞–≥—Ä—É–∑–∫—É: –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ—Ä–∏—é –¥–µ–π—Å—Ç–≤–∏–π –≤–æ ViewModel, –∑–∞—Ç–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ‚Äì –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ. –≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø–æ–º–æ–≥—É—Ç –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞—Ö –Ω–µ –ø–æ–ª–æ–º–∞—Ç—å –ª–æ–≥–∏–∫—É.

6. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –≤—ã—à–µ–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏–π, –ø—Ä–æ–π–¥–∏—Ç–µ—Å—å –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É —á–µ–∫-–ª–∏—Å—Ç—É, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã:

Typewriter —ç—Ñ—Ñ–µ–∫—Ç:

 –¢–µ–∫—Å—Ç –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –µ—ë –ø–æ—è–≤–ª–µ–Ω–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ –ª–æ–≥–∞–º, —á—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π lineId –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ ‚å®Ô∏è –ù–∞—á–∞–ª–æ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏ –∏ –æ–¥–∏–Ω ‚úÖ –¢–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω
GitHub
).

 –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –∫–ª–∏–∫–µ –≤–æ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏ —Ç–µ–∫—Å—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –≤–Ω–µ–∑–∞–ø–Ω–æ. –í—Ç–æ—Ä–æ–π –∫–ª–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–ø–ª–∏–∫–µ.

 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ (—á–µ—Ä–µ–∑ 900 –º—Å) —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞ —Ç–µ–∫—Å—Ç–∞. –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—å –ø—Ä–µ–∂–¥–µ ‚Äì –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤ üßπ –û—Ç–º–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
GitHub
 –ø—Ä–∏ –∫–ª–∏–∫–µ).

 –ù–µ—Ç —É—Ç–µ—á–µ–∫ —Ç–∞–π–º–µ—Ä–æ–≤: –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –ø–æ–¥—Ä—è–¥ –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–º–æ–∂–Ω–æ –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤).

 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö –∞–±–∑–∞—Ü–∞—Ö (~200+ —Å–∏–º–≤–æ–ª–æ–≤) –∞–Ω–∏–º–∞—Ü–∏—è –∏–¥—ë—Ç –ø–ª–∞–≤–Ω–æ, –±–µ–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è CPU (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ useRef –¥–æ–ª–∂–Ω–∞ –ø–æ–º–æ—á—å).

–°–∏—Å—Ç–µ–º–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤—ã–±–æ—Ä–æ–≤:

 –ü—Ä–∏ –≤—ã–±–æ—Ä–µ, –∏–º–µ—é—â–µ–º —ç—Ñ—Ñ–µ–∫—Ç stat_modifier, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –æ–∂–∏–¥–∞–µ–º—É—é –≤–µ–ª–∏—á–∏–Ω—É. –ï—Å–ª–∏ —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω –ø—Ä–æ–ø–∞–¥–∞–µ—Ç.

 –≠—Ñ—Ñ–µ–∫—Ç add_item: –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –∏–≥—Ä–æ–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω—É–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ. –ï—Å–ª–∏ –≤—ã–±–æ—Ä —Å–¥–µ–ª–∞–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –¥—Ä—É–≥–æ–π –≤–µ—Ç–∫–µ), –ø—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è (–∏ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è —Å–≤–µ—Ä—Ö –æ–∂–∏–¥–∞–µ–º–æ–≥–æ).

 –≠—Ñ—Ñ–µ–∫—Ç add_quest: –Ω–æ–≤—ã–π –∫–≤–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤, —Å—Ç–∞—Ç—É—Å "–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ". –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚Äì –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –∫–≤–µ—Å—Ç–∞.

 –≠—Ñ—Ñ–µ–∫—Ç relationship_change: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ—Ñ–∏–ª–µ NPC –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –≤ –ª–æ–≥–∞—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä —É—Ö–æ–¥–∏—Ç –∏–∑–º–µ–Ω—ë–Ω–Ω–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.

 –í—Å–µ –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ SessionStore –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: –ø–æ—Å–ª–µ —Å—Ü–µ–Ω—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ consumePayload –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, items, quests) –∏ –æ–Ω–∏ —É—Ö–æ–¥—è—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –õ–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ devtools Network) –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–µ add_item payload —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç
GitHub
.

 –†–µ–≥—Ä–µ—Å—Å–∏—è: —Å—Ç–∞—Ä—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (—Ñ–ª–∞–≥–∏, xp, reputation) –≤—Å—ë –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ –∑–∞–¥–≤–æ–∏–ª–∏—Å—å. –í—ã–±–æ—Ä —Å —Ñ–ª–∞–≥–æ–º –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ –∫–∞–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º ViewModel, —Ç–∞–∫ –∏ –≤ SessionStore payload
GitHub
GitHub
.

–°–∏—Å—Ç–µ–º–∞ —Ç–æ—á–µ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ:

 –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏: –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ–∫–Ω–æ —Å —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤. –¢–æ–≤–∞—Ä—ã –∏ —Ü–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–¥–∞–Ω–Ω—ã–º –≤ –¥–∞–Ω–Ω—ã—Ö.

 –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞: –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∑–æ–ª–æ—Ç–æ –∏–≥—Ä–æ–∫–∞ –∏ —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–≥—Ä–æ–∫—É. –ï—Å–ª–∏ —É NPC –±—ã–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∑–∞–ø–∞—Å, –æ–Ω —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è (–∏–ª–∏ —Ç–æ–≤–∞—Ä –∏—Å—á–µ–∑–∞–µ—Ç, –µ—Å–ª–∏ –±—ã–ª–æ 1 —à—Ç.). –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å, –µ—Å–ª–∏ –¥–µ–Ω–µ–≥ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (–∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ).

 –ü—Ä–æ–¥–∞–∂–∞ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞): –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ —Ç–æ–≤–∞—Ä —É–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞, –∑–æ–ª–æ—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, —Ç–æ–≤–∞—Ä –ø–æ—è–≤–ª—è–µ—Ç—Å—è —É —Ç–æ—Ä–≥–æ–≤—Ü–∞ (–µ—Å–ª–∏ —Ä–µ—à–µ–Ω–æ —Ç–∞–∫).

 –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –∫–∞—Ä—Ç—É; –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ –æ—Ç—Ä–∞–∂–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –∫—É–ø–ª–µ–Ω–æ, —É –∏–≥—Ä–æ–∫–∞ –º–µ–Ω—å—à–µ –¥–µ–Ω–µ–≥, —É —Ç–æ—Ä–≥–æ–≤—Ü–∞ ‚Äì –º–µ–Ω—å—à–µ —Ç–æ–≤–∞—Ä–∞).

 –£–ª—É—á—à–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è: –≤ –æ–∫–Ω–µ —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–µ–¥–º–µ—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤/—Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è ‚Äì —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, —Ä–µ—Å—É—Ä—Å —Å–ø–∏—Å–∞–Ω, –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –≤ UI –≤–∏–¥–Ω–æ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤). –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –Ω—É–∂–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–ª–∏ –¥–µ–Ω–µ–≥ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ).

 –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–¥ —Ç–µ–º –∂–µ id –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–π id —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ ‚Äì –ø—Ä–æ–¥—É–º–∞—Ç—å –∫–∞–∫ –≤—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏).

 –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤—ã–∫–æ–≤: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –ø–µ—Ä–µ—á–Ω–µ–º —Ç—Ä–µ–Ω–∏—Ä—É–µ–º—ã—Ö –Ω–∞–≤—ã–∫–æ–≤. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–∞–≤—ã–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ ‚Äì —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç—Ä–µ–±—É–µ–º—ã–µ –æ—á–∫–∏/–≤–∞–ª—é—Ç–∞, —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É–∂–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç —Å –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º ‚Äì —ç—Ç–æ –¥–æ–ø. –ª–æ–≥–∏–∫–∞).

 –î–∏–∞–ª–æ–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏: –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–æ—á–∫—É —Å –¥–∏–∞–ª–æ–≥–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Å—Ü–µ–Ω–∞ VN. –î–∏–∞–ª–æ–≥ –ø—Ä–æ—Ö–æ–¥–∏—Ç, –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É –∏–ª–∏ –ø–æ –Ω–∞–∂–∞—Ç–∏—é ¬´–í—ã–π—Ç–∏¬ª). –ï—Å–ª–∏ –≤ –¥–∏–∞–ª–æ–≥–µ –±—ã–ª–∏ –≤–µ—Ç–∫–∏, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, NPC-—Ä–∞–∑–¥–≤–æ–µ–Ω–∏–µ: –ø–æ –æ–¥–Ω–æ–º—É –≤—ã–±–æ—Ä—É –ø—Ä–æ—Å—Ç–æ –∫–æ–Ω–µ—Ü –¥–∏–∞–ª–æ–≥–∞, –ø–æ –¥—Ä—É–≥–æ–º—É ‚Äì –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é –∏ –ø–æ—Ç–æ–º –∫–æ–Ω–µ—Ü).

 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VN <-> –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: –¥–ª—è —Ç–æ—á–µ–∫, –≥–¥–µ –¥–∏–∞–ª–æ–≥ –≤–µ–¥—ë—Ç –∫ —Ç–æ—Ä–≥–æ–≤–ª–µ/—É–ª—É—á—à–µ–Ω–∏—é, –ø—Ä–æ–π—Ç–∏ –≤–µ—Å—å —Ü–∏–∫–ª. –ù–∞–ø—Ä–∏–º–µ—Ä: –∫—É–∑–Ω–µ—Ü –∑–¥–æ—Ä–æ–≤–∞–µ—Ç—Å—è (VN), –≤—ã–±–∏—Ä–∞–µ–º ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã¬ª, VN –º–æ–¥–∞–ª –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è TradeWindow, –ø–æ–∫—É–ø–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç, –∑–∞–∫—Ä—ã–≤–∞–µ–º TradeWindow, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å—Ü–µ–Ω–µ –∫—É–∑–Ω–µ—Ü–∞ (–µ—Å–ª–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞) –∏–ª–∏ —Å—Ä–∞–∑—É –Ω–∞ –∫–∞—Ä—Ç—É. –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–ª–∞–≤–Ω—ã–º–∏, –±–µ–∑ –æ—Å—Ç–∞—é—â–∏—Ö—Å—è –ø–æ–≤–µ—Ä—Ö –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –æ–∫–æ–Ω.

–ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –Ω–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ—Ä–≥–æ–≤–ª–∏, —Ç–æ –ø–æ –∑–∞–∫—Ä—ã—Ç–∏—é —Ç–æ—Ä–≥–æ–≤–ª–∏ –ª–∏–±–æ –∞–≤—Ç–æ–∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ —Ç–æ–∂–µ, –ª–∏–±–æ NPC –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ-—Ç–æ –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–µ ‚Äì —Ä–µ—à–∏—Ç—å –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞: –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å—Ü–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–ø–ª–∏–∫, –≤ —Ç–æ–º —á–∏—Å–ª–µ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏). –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å ‚Äì —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ü–µ–Ω—ã –∏ —Ä–µ–ø–ª–∏–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º (–¥–∏–∞–ª–æ–≥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞, —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ).

–í—Å–µ —Ñ–ª–∞–≥–∏/—ç—Ñ—Ñ–µ–∫—Ç—ã, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç (–ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω—ã, –∏ —Ç.–¥.).

–≠—Ñ—Ñ–µ–∫—Ç—ã, —É–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏. (–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã–±–æ—Ä –¥–∞–ª +10 XP –∏ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —É –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ—Ç –∂–µ –æ–ø—ã—Ç, –Ω–µ +20). –≠—Ç–æ –≤–∞–∂–Ω–æ: –µ—Å–ª–∏ –∑–∞–º–µ—Ç–∏—Ç–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø—Ä–∞–≤—å—Ç–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

–°–¥–µ–ª–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ü–µ —Å—Ü–µ–Ω—ã (–∫–æ–≥–¥–∞ isSceneCompleted=true) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å ‚Äì –¥–æ–ª–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏–±–æ –∑–∞–≤–µ—Ä–∏—Ç—å —Å—Ü–µ–Ω—É —Å—Ä–∞–∑—É, –ª–∏–±–æ –Ω–∞—á–∞—Ç—å —Å –∫–æ–Ω—Ü–∞. –í–æ–∑–º–æ–∂–Ω–æ, –ª—É—á—à–µ –Ω–µ —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏, –∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—É –∏ —Ç–∞–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.

 –ê–≤—Ç–æ—Å–µ–π–≤: –µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ autosave, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞.

 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–ø–∏–∑–æ–¥–∞—Ö: –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–π —Å—Ü–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100+ —Ä–µ–ø–ª–∏–∫). UI –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø–ª–∞–≤–Ω—ã–º, –±–µ–∑ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–π –∑–∞–¥–µ—Ä–∂–∫–∏. –ü–∞–º—è—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–∞ —É—Ç–µ–∫–∞—Ç—å (–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ DevTools: garbage collect ‚Äì —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ —Ä–∞—Å—Ç—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ). –õ–æ–≥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤.

 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (Activity/memo) –Ω–µ –Ω–∞—Ä—É—à–∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

–ü–æ—è–≤–ª–µ–Ω–∏–µ/—Å–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –≤—ã–±–æ—Ä–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è –∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–±–æ—Ä–∞ (–µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–¥–µ–ª—è–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç –∏ —Ä–µ—à–∏–ª–∏ —â—ë–ª–∫–Ω—É—Ç—å –≤–Ω–µ ‚Äì –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤—ã–¥–µ–ª–µ–Ω, –µ—Å–ª–∏ —Ç–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å).

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç CharacterGroup –∞–Ω–∏–º–∏—Ä—É–µ—Ç —Å–º–µ–Ω—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É —Ä–µ–ø–ª–∏–∫–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ —É–≤–∏–¥–µ—Ç—å –ø–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏). –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –º–µ–Ω—è–µ—Ç —ç–º–æ—Ü–∏—é (mood) –º–µ–∂–¥—É —Ä–µ–ø–ª–∏–∫–∞–º–∏, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –µ–≥–æ –∞–≤–∞—Ç–∞—Ä —Ç–æ–∂–µ –æ–±–Ω–æ–≤–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–º–µ–Ω–∏–ª—Å—è —Å–ø—Ä–∞–π—Ç) —Å –Ω—É–∂–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π.

 –ö—Ä–æ—Å—Å-–±—Ä–∞—É–∑–µ—Ä–Ω–æ—Å—Ç—å –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å: –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–∞—Ä–µ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤, –∞ —Ç–∞–∫–∂–µ –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é, –µ—Å–ª–∏ —Ü–µ–ª–∏—Ç–µ—Å—å –Ω–∞ –Ω–µ—ë. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —É–¥–æ–±–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º (—Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏, –∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ —Ç.–ø.).

 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏: –Ω–∏–∫–∞–∫–∏—Ö Unhandled Promise, React warning‚Äô–æ–≤ –æ –∫–ª—é—á–∞—Ö, –∏ –ø—Ä–æ—á. –ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Å–æ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ¬´–∑–µ–ª—ë–Ω–æ–π¬ª, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –≤–∞—à–∏—Ö –ª–æ–≥–æ–≤. –û—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∏–∫–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–Ω–µ —Ä–µ–Ω–¥–µ—Ä–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å, –µ—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å).
